{"version":3,"sources":["../../../src/researches/findKeywordInPageTitle.js"],"names":["wordMatch","findTopicFormsInString","getFunctionWordsFactory","escapeRegExp","filter","get","includes","isEmpty","isUndefined","getLanguage","getWords","getFunctionWords","stripFunctionWordsFromStart","functionWords","str","toLocaleLowerCase","titleWords","word","trim","processExactMatchRequest","keyword","exactMatchRequest","exactMatchRequested","doubleQuotes","length","substring","adjustPosition","title","position","locale","process","env","YOAST_RECALIBRATION","language","all","titleBeforeKeyword","substr","paper","researcher","getKeyword","getTitle","getLocale","result","exactMatchFound","allWordsFound","exactMatchKeyphrase","keywordMatched","count","topicForms","getResearch","useSynonyms","separateWordsMatched","percentWordMatches"],"mappings":"AAAA;;AAEA,OAAOA,SAAP,MAAsB,0CAAtB;AACA,SAASC,sBAAT,QAAuC,+BAAvC;;AAEA,OAAOC,uBAAP,MAAoC,6BAApC;;AAEA,SAASC,YAAT,EAAuBC,MAAvB,EAA+BC,GAA/B,EAAoCC,QAApC,EAA8CC,OAA9C,EAAuDC,WAAvD,QAA0E,WAA1E;AACA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,OAAOC,QAAP,MAAqB,8BAArB;;AAEA,MAAMC,mBAAmBT,yBAAzB;;AAEA;;;;;;;;AAQA,MAAMU,8BAA8B,UAAUC,aAAV,EAAyBC,GAAzB,EAA+B;AAClEA,OAAMA,IAAIC,iBAAJ,EAAN;AACA,KAAIC,aAAaN,SAAUI,IAAIC,iBAAJ,EAAV,CAAjB;;AAEA;AACAC,cAAaZ,OAAQY,UAAR,EAAoB,UAAUC,IAAV,EAAiB;AACjD,SAAS,CAAEX,SAAUO,aAAV,EAAyBI,KAAKC,IAAL,GAAYH,iBAAZ,EAAzB,CAAX;AACA,EAFY,CAAb;;AAIA,QAAOR,QAASS,UAAT,CAAP;AACA,CAVD;;AAYA;;;;;;;AAOA,MAAMG,2BAA2B,UAAUC,OAAV,EAAoB;AACpD,OAAMC,oBAAoB,EAAEC,qBAAqB,KAAvB,EAA8BF,SAASA,OAAvC,EAA1B;;AAEA;AACA,OAAMG,eAAe,CAAE,GAAF,EAAO,GAAP,EAAY,GAAZ,EAAiB,GAAjB,EAAsB,GAAtB,EAA2B,GAA3B,EAAgC,GAAhC,EAAqC,IAArC,CAArB;AACA,KAAKjB,SAAUiB,YAAV,EAAwBH,QAAS,CAAT,CAAxB,KAA0Cd,SAAUiB,YAAV,EAAwBH,QAASA,QAAQI,MAAR,GAAiB,CAA1B,CAAxB,CAA/C,EAAyG;AACxGH,oBAAkBD,OAAlB,GAA4BA,QAAQK,SAAR,CAAmB,CAAnB,EAAsBL,QAAQI,MAAR,GAAiB,CAAvC,CAA5B;AACAH,oBAAkBC,mBAAlB,GAAwC,IAAxC;AACA;;AAED,QAAOD,iBAAP;AACA,CAXD;;AAaA;;;;;;;;;AASA,MAAMK,iBAAiB,UAAUC,KAAV,EAAiBC,QAAjB,EAA2BC,MAA3B,EAAoC;AAC1D;AACA,KAAKD,aAAa,CAAlB,EAAsB;AACrB,SAAOA,QAAP;AACA;;AAED;AACA,KAAK,EAAIE,QAAQC,GAAR,CAAYC,mBAAZ,KAAoC,SAAxC,CAAL,EAA2D;AAC1D,SAAOJ,QAAP;AACA;;AAED;AACA,OAAMK,WAAWxB,YAAaoB,MAAb,CAAjB;AACA,OAAMhB,gBAAgBR,IAAKM,gBAAL,EAAuB,CAAEsB,QAAF,CAAvB,EAAqC,EAArC,CAAtB;AACA,KAAKzB,YAAaK,cAAcqB,GAA3B,CAAL,EAAwC;AACvC,SAAON,QAAP;AACA;;AAED;AACA,OAAMO,qBAAqBR,MAAMS,MAAN,CAAc,CAAd,EAAiBR,QAAjB,CAA3B;AACA,KAAKhB,4BAA6BC,cAAcqB,GAA3C,EAAgDC,kBAAhD,CAAL,EAA4E;AAC3E;;;;AAIA,SAAO,CAAP;AACA;;AAED,QAAOP,QAAP;AACA,CA7BD;;AAgCA;;;;;;;;;;;AAWA,eAAe,UAAUS,KAAV,EAAiBC,UAAjB,EAA8B;AAC5C,KAAIlB,UAAUjB,aAAckC,MAAME,UAAN,EAAd,CAAd;AACA,OAAMZ,QAAQU,MAAMG,QAAN,EAAd;AACA,OAAMX,SAASQ,MAAMI,SAAN,EAAf;;AAEA,OAAMC,SAAS,EAAEC,iBAAiB,KAAnB,EAA0BC,eAAe,KAAzC,EAAgDhB,UAAU,CAAC,CAA3D,EAA8DiB,qBAAqB,KAAnF,EAAf;;AAEA;AACA,OAAMxB,oBAAoBF,yBAA0BC,OAA1B,CAA1B;AACA,KAAKC,kBAAkBC,mBAAvB,EAA6C;AAC5CF,YAAUC,kBAAkBD,OAA5B;AACAsB,SAAOG,mBAAP,GAA6B,IAA7B;AACA;;AAED;AACA,OAAMC,iBAAiB9C,UAAW2B,KAAX,EAAkBP,OAAlB,EAA2BS,MAA3B,CAAvB;;AAEA,KAAKiB,eAAeC,KAAf,GAAuB,CAA5B,EAAgC;AAC/BL,SAAOC,eAAP,GAAyB,IAAzB;AACAD,SAAOE,aAAP,GAAuB,IAAvB;AACAF,SAAOd,QAAP,GAAkBF,eAAgBC,KAAhB,EAAuBmB,eAAelB,QAAtC,EAAgDC,MAAhD,CAAlB;;AAEA,SAAOa,MAAP;AACA;;AAED;AACA,OAAMM,aAAaV,WAAWW,WAAX,CAAwB,YAAxB,CAAnB;;AAEA;AACA,OAAMC,cAAc,KAApB;;AAEA,OAAMC,uBAAuBlD,uBAAwB+C,UAAxB,EAAoCrB,KAApC,EAA2CuB,WAA3C,EAAwDrB,MAAxD,CAA7B;;AAEA,KAAKsB,qBAAqBC,kBAArB,KAA4C,GAAjD,EAAuD;AACtDV,SAAOE,aAAP,GAAuB,IAAvB;AACA;;AAED,QAAOF,MAAP;AACA","file":"findKeywordInPageTitle.js","sourcesContent":["/** @module analyses/findKeywordInPageTitle */\n\nimport wordMatch from \"../stringProcessing/matchTextWithWord.js\";\nimport { findTopicFormsInString } from \"./findKeywordFormsInString.js\";\n\nimport getFunctionWordsFactory from \"../helpers/getFunctionWords\";\n\nimport { escapeRegExp, filter, get, includes, isEmpty, isUndefined } from \"lodash-es\";\nimport getLanguage from \"../helpers/getLanguage\";\nimport getWords from \"../stringProcessing/getWords\";\n\nconst getFunctionWords = getFunctionWordsFactory();\n\n/**\n * Strips all function words from the start of the given string.\n *\n * @param {string[]} functionWords The array of function words to strip from the start.\n * @param {string} str The string from which to strip the function words.\n *\n * @returns {boolean} Whether the string consists of function words only.\n */\nconst stripFunctionWordsFromStart = function( functionWords, str ) {\n\tstr = str.toLocaleLowerCase();\n\tlet titleWords = getWords( str.toLocaleLowerCase() );\n\n\t// Strip all function words from the start of the string.\n\ttitleWords = filter( titleWords, function( word ) {\n\t\treturn ( ! includes( functionWords, word.trim().toLocaleLowerCase() ) );\n\t} );\n\n\treturn isEmpty( titleWords );\n};\n\n/**\n * Checks if exact match functionality is requested by enclosing the keyphrase in double quotation marks.\n *\n * @param {string} keyword The keyword to check.\n *\n * @returns {Object} Whether the exact match funcionality is requested and the keyword stripped from double quotes.\n */\nconst processExactMatchRequest = function( keyword ) {\n\tconst exactMatchRequest = { exactMatchRequested: false, keyword: keyword };\n\n\t// Check if morphology is suppressed. If so, strip the quotation marks from the keyphrase.\n\tconst doubleQuotes = [ \"“\", \"”\", \"〝\", \"〞\", \"〟\", \"‟\", \"„\", \"\\\"\" ];\n\tif ( includes( doubleQuotes, keyword[ 0 ] ) && includes( doubleQuotes, keyword[ keyword.length - 1 ] ) ) {\n\t\texactMatchRequest.keyword = keyword.substring( 1, keyword.length - 1 );\n\t\texactMatchRequest.exactMatchRequested = true;\n\t}\n\n\treturn exactMatchRequest;\n};\n\n/**\n * Checks whether an exact match of the keyphrase is found in the title.\n *\n * @param {string} title The title of the paper.\n * @param {number} position The position of the keyphrase in the title.\n * @param {string} locale The locale of the paper.\n *\n * @returns {number} Potentially adjusted position of the keyphrase in the title.\n */\nconst adjustPosition = function( title, position, locale ) {\n\t// Don't do anything if position if already 0.\n\tif ( position === 0 ) {\n\t\treturn position;\n\t}\n\n\t// Don't do anything for non-recalibration.\n\tif ( ! ( process.env.YOAST_RECALIBRATION === \"enabled\" ) ) {\n\t\treturn position;\n\t}\n\n\t// Don't do anything if no function words exist for this locale.\n\tconst language = getLanguage( locale );\n\tconst functionWords = get( getFunctionWords, [ language ], [] );\n\tif ( isUndefined( functionWords.all ) ) {\n\t\treturn position;\n\t}\n\n\t// Strip all function words from the beginning of the title.\n\tconst titleBeforeKeyword = title.substr( 0, position );\n\tif ( stripFunctionWordsFromStart( functionWords.all, titleBeforeKeyword ) ) {\n\t\t/*\n\t\t * Return position 0 if there are no words left in the title before the keyword after filtering\n\t\t * the function words (such that \"keyword\" in \"the keyword\" is still counted as position 0).\n \t\t */\n\t\treturn 0;\n\t}\n\n\treturn position;\n};\n\n\n/**\n * Counts the occurrences of the keyword in the page title. Returns the result that contains information on\n * (1) whether the exact match of the keyphrase was used in the title,\n * (2) whether all (content) words from the keyphrase were found in the title,\n * (3) at which position the exact match was found in the title.\n *\n * @param {Object} paper The paper containing title and keyword.\n * @param {Researcher} researcher The researcher to use for analysis.\n *\n * @returns {Object} result with the information on whether the keyphrase was matched in the title and how.\n */\nexport default function( paper, researcher ) {\n\tlet keyword = escapeRegExp( paper.getKeyword() );\n\tconst title = paper.getTitle();\n\tconst locale = paper.getLocale();\n\n\tconst result = { exactMatchFound: false, allWordsFound: false, position: -1, exactMatchKeyphrase: false  };\n\n\t// Check if the keyphrase is enclosed in double quotation marks to ensure that only exact matches are processed.\n\tconst exactMatchRequest = processExactMatchRequest( keyword );\n\tif ( exactMatchRequest.exactMatchRequested ) {\n\t\tkeyword = exactMatchRequest.keyword;\n\t\tresult.exactMatchKeyphrase = true;\n\t}\n\n\t// Check if the exact match of the keyphrase found in the title.\n\tconst keywordMatched = wordMatch( title, keyword, locale );\n\n\tif ( keywordMatched.count > 0 ) {\n\t\tresult.exactMatchFound = true;\n\t\tresult.allWordsFound = true;\n\t\tresult.position = adjustPosition( title, keywordMatched.position, locale );\n\n\t\treturn result;\n\t}\n\n\t// Check 2: Are all content words from the keyphrase in the title?\n\tconst topicForms = researcher.getResearch( \"morphology\" );\n\n\t// Use only keyphrase ( not the synonyms) to match topic words in the title.\n\tconst useSynonyms = false;\n\n\tconst separateWordsMatched = findTopicFormsInString( topicForms, title, useSynonyms, locale );\n\n\tif ( separateWordsMatched.percentWordMatches === 100 ) {\n\t\tresult.allWordsFound = true;\n\t}\n\n\treturn result;\n}\n"]}