{"version":3,"sources":["../../../src/worker/AnalysisWebWorker.js"],"names":["autop","Jed","forEach","has","includes","isNull","isObject","isString","isUndefined","merge","pickBy","getLogger","assessments","bundledPlugins","helpers","markers","string","interpreters","config","Assessor","Assessment","SEOAssessor","ContentAssessor","TaxonomyAssessor","Pluggable","Researcher","SnippetPreview","Paper","AssessmentResult","RelatedKeywordAssessor","YoastSEO","CornerstoneContentAssessor","CornerstoneRelatedKeywordAssessor","CornerstoneSEOAssessor","InvalidTypeError","includesAny","configureShortlinker","RelatedKeywordTaxonomyAssessor","Scheduler","Transporter","wrapTryCatchAroundAction","keyphraseDistribution","seo","KeyphraseDistributionAssessment","logger","setDefaultLevel","AnalysisWebWorker","constructor","scope","_scope","_configuration","contentAnalysisActive","keywordAnalysisActive","useCornerstone","useTaxonomy","useKeywordDistribution","locale","_scheduler","_paper","_relatedKeywords","_i18n","createI18n","_researcher","_contentAssessor","_seoAssessor","_relatedKeywordAssessor","_results","readability","results","score","_registeredAssessments","_registeredMessageHandlers","analyze","bind","analyzeDone","analyzeRelatedKeywordsDone","loadScript","loadScriptDone","customMessage","customMessageDone","clearCache","runResearch","runResearchDone","registerAssessment","registerMessageHandler","refreshAssessment","handleMessage","analyzeRelatedKeywords","register","onmessage","analysisWorker","yoast","analysis","data","type","id","payload","parse","debug","initialize","startPolling","schedule","execute","done","name","error","Error","console","warn","translations","domain","locale_data","createContentAssessor","assessor","createSEOAssessor","researcher","getAssessment","addAssessment","assessment","createRelatedKeywordsAssessor","send","serialize","postMessage","shouldAssessorsUpdate","configuration","contentAssessor","seoAssessor","configurationKeys","Object","keys","update","researchData","research","addResearchData","params","defaultQueryParams","setLevel","logLevel","pluginName","combinedName","push","handler","setLocale","shouldReadabilityUpdate","paper","getText","getLocale","shouldSeoUpdate","key","keyword","synonyms","relatedKeywords","_text","removeHtmlBlocks","paperHasChanges","equals","setPaper","assess","calculateOverallScore","requestedRelatedKeywordKeys","relatedKeyword","relatedPaper","length","url","loaded","message","importScripts","result","success","getResearch"],"mappings":";;AAAA;AACA,SAASA,KAAT,QAAsB,kBAAtB;AACA,OAAOC,GAAP,MAAgB,KAAhB;AACA,SAASC,OAAT,EAAkBC,GAAlB,EAAuBC,QAAvB,EAAiCC,MAAjC,EAAyCC,QAAzC,EAAmDC,QAAnD,EAA6DC,WAA7D,EAA0EC,KAA1E,EAAiFC,MAAjF,QAA+F,WAA/F;AACA,SAASC,SAAT,QAA0B,UAA1B;;AAEA;AACA,OAAO,KAAKC,WAAZ,MAA6B,gBAA7B;AACA,OAAO,KAAKC,cAAZ,MAAgC,mBAAhC;AACA,OAAO,KAAKC,OAAZ,MAAyB,YAAzB;AACA,OAAO,KAAKC,OAAZ,MAAyB,YAAzB;AACA,OAAO,KAAKC,MAAZ,MAAwB,qBAAxB;AACA,OAAO,KAAKC,YAAZ,MAA8B,iBAA9B;AACA,OAAO,KAAKC,MAAZ,MAAwB,WAAxB;;AAEA,OAAOC,QAAP,MAAqB,aAArB;AACA,OAAOC,UAAP,MAAuB,eAAvB;AACA,OAAOC,WAAP,MAAwB,gBAAxB;AACA,OAAOC,eAAP,MAA4B,oBAA5B;AACA,OAAOC,gBAAP,MAA6B,qBAA7B;AACA,OAAOC,SAAP,MAAsB,cAAtB;AACA,OAAOC,UAAP,MAAuB,eAAvB;AACA,OAAOC,cAAP,MAA2B,mBAA3B;AACA,OAAOC,KAAP,MAAkB,iBAAlB;AACA,OAAOC,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,sBAAP,MAAmC,2BAAnC;;AAEA,MAAMC,WAAW;AAChBX,SADgB;AAEhBC,WAFgB;AAGhBC,YAHgB;AAIhBC,gBAJgB;AAKhBC,iBALgB;AAMhBC,UANgB;AAOhBC,WAPgB;AAQhBC,eARgB;AAShBG,uBATgB;;AAWhBF,MAXgB;AAYhBC,iBAZgB;;AAchBhB,YAdgB;AAehBC,eAfgB;AAgBhBC,QAhBgB;AAiBhBC,QAjBgB;AAkBhBC,OAlBgB;AAmBhBC,aAnBgB;AAoBhBC;AApBgB,CAAjB;;AAuBA;AACA,OAAOa,0BAAP,MAAuC,gCAAvC;AACA,OAAOC,iCAAP,MAA8C,uCAA9C;AACA,OAAOC,sBAAP,MAAmC,4BAAnC;AACA,OAAOC,gBAAP,MAA6B,uBAA7B;AACA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,SAASC,oBAAT,QAAqC,wBAArC;AACA,OAAOC,8BAAP,MAA2C,mCAA3C;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,wBAAP,MAAqC,4BAArC;;AAGA,MAAMC,wBAAwB,IAAI7B,YAAY8B,GAAZ,CAAgBC,+BAApB,EAA9B;;AAEA,MAAMC,SAASjC,UAAW,uBAAX,CAAf;AACAiC,OAAOC,eAAP,CAAwB,OAAxB;;AAEA;;;;;;AAMA,eAAe,MAAMC,iBAAN,CAAwB;AACtC;;;;;;AAMAC,aAAaC,KAAb,EAAqB;AACpB,OAAKC,MAAL,GAAcD,KAAd;;AAEA,OAAKE,cAAL,GAAsB;AACrBC,0BAAuB,IADF;AAErBC,0BAAuB,IAFF;AAGrBC,mBAAgB,KAHK;AAIrBC,gBAAa,KAJQ;AAKrBC,2BAAwB,KALH;AAMrB;AACAC,WAAQ;AAPa,GAAtB;;AAUA,OAAKC,UAAL,GAAkB,IAAInB,SAAJ,EAAlB;;AAEA,OAAKoB,MAAL,GAAc,IAAd;AACA,OAAKC,gBAAL,GAAwB,EAAxB;;AAEA,OAAKC,KAAL,GAAad,kBAAkBe,UAAlB,EAAb;AACA,OAAKC,WAAL,GAAmB,IAAIrC,UAAJ,CAAgB,KAAKiC,MAArB,CAAnB;;AAEA,OAAKK,gBAAL,GAAwB,IAAxB;AACA,OAAKC,YAAL,GAAoB,IAApB;AACA,OAAKC,uBAAL,GAA+B,IAA/B;;AAEA;;;;;;;;;;;;;AAaA,OAAKC,QAAL,GAAgB;AACfC,gBAAa;AACZC,aAAS,EADG;AAEZC,WAAO;AAFK,IADE;AAKf3B,QAAK;AACJ,QAAI;AACH0B,cAAS,EADN;AAEHC,YAAO;AAFJ;AADA;AALU,GAAhB;AAYA,OAAKC,sBAAL,GAA8B,EAA9B;AACA,OAAKC,0BAAL,GAAkC,EAAlC;;AAEA;AACA,OAAKC,OAAL,GAAe,KAAKA,OAAL,CAAaC,IAAb,CAAmB,IAAnB,CAAf;AACA,OAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBD,IAAjB,CAAuB,IAAvB,CAAnB;AACA,OAAKE,0BAAL,GAAkC,KAAKA,0BAAL,CAAgCF,IAAhC,CAAsC,IAAtC,CAAlC;AACA,OAAKG,UAAL,GAAkB,KAAKA,UAAL,CAAgBH,IAAhB,CAAsB,IAAtB,CAAlB;AACA,OAAKI,cAAL,GAAsB,KAAKA,cAAL,CAAoBJ,IAApB,CAA0B,IAA1B,CAAtB;AACA,OAAKK,aAAL,GAAqB,KAAKA,aAAL,CAAmBL,IAAnB,CAAyB,IAAzB,CAArB;AACA,OAAKM,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBN,IAAvB,CAA6B,IAA7B,CAAzB;AACA,OAAKO,UAAL,GAAkB,KAAKA,UAAL,CAAgBP,IAAhB,CAAsB,IAAtB,CAAlB;AACA,OAAKQ,WAAL,GAAmB,KAAKA,WAAL,CAAiBR,IAAjB,CAAuB,IAAvB,CAAnB;AACA,OAAKS,eAAL,GAAuB,KAAKA,eAAL,CAAqBT,IAArB,CAA2B,IAA3B,CAAvB;;AAEA;AACA,OAAKU,kBAAL,GAA0B,KAAKA,kBAAL,CAAwBV,IAAxB,CAA8B,IAA9B,CAA1B;AACA,OAAKW,sBAAL,GAA8B,KAAKA,sBAAL,CAA4BX,IAA5B,CAAkC,IAAlC,CAA9B;AACA,OAAKY,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBZ,IAAvB,CAA6B,IAA7B,CAAzB;;AAEA;AACA,OAAKa,aAAL,GAAqB,KAAKA,aAAL,CAAmBb,IAAnB,CAAyB,IAAzB,CAArB;;AAEA;AACA,OAAKc,sBAAL,GACC/C,yBAA0BI,MAA1B,EAAkC,KAAK4B,OAAvC,EAAgD,gEAAhD,CADD;AAEA;;;;AAIA,OAAKA,OAAL,GAAehC,yBAA0BI,MAA1B,EAAkC,KAAK4B,OAAvC,EAAgD,+CAAhD,CAAf;AACA,OAAKS,WAAL,GAAmBzC,yBAA0BI,MAA1B,EAAkC,KAAKqC,WAAvC,EAClB,0DADkB,CAAnB;AAEA;;AAED;;;;;AAKAO,YAAW;AACV,OAAKvC,MAAL,CAAYwC,SAAZ,GAAwB,KAAKH,aAA7B;AACA,OAAKrC,MAAL,CAAYyC,cAAZ,GAA6B;AAC5BP,uBAAoB,KAAKA,kBADG;AAE5BC,2BAAwB,KAAKA,sBAFD;AAG5BC,sBAAmB,KAAKA;AAHI,GAA7B;AAKA,OAAKpC,MAAL,CAAY0C,KAAZ,GAAoB,KAAK1C,MAAL,CAAY0C,KAAZ,IAAqB,EAAzC;AACA,OAAK1C,MAAL,CAAY0C,KAAZ,CAAkBC,QAAlB,GAA6B9D,QAA7B;AACA;;AAED;;;;;;;;;;;;;AAaAwD,eAAe,EAAEO,MAAM,EAAEC,IAAF,EAAQC,EAAR,EAAYC,OAAZ,EAAR,EAAf,EAAiD;AAChDA,YAAUzD,YAAY0D,KAAZ,CAAmBD,OAAnB,CAAV;;AAEApD,SAAOsD,KAAP,CAAc,6BAAd,EAA6CJ,IAA7C,EAAmDC,EAAnD,EAAuDC,OAAvD;;AAEA,UAASF,IAAT;AACC,QAAK,YAAL;AACC,SAAKK,UAAL,CAAiBJ,EAAjB,EAAqBC,OAArB;AACA,SAAKvC,UAAL,CAAgB2C,YAAhB;AACA;AACD,QAAK,SAAL;AACC,SAAK3C,UAAL,CAAgB4C,QAAhB,CAA0B;AACzBN,OADyB;AAEzBO,cAAS,KAAK9B,OAFW;AAGzB+B,WAAM,KAAK7B,WAHc;AAIzBmB,WAAMG,OAJmB;AAKzBF,WAAMA;AALmB,KAA1B;AAOA;AACD,QAAK,wBAAL;AACC,SAAKrC,UAAL,CAAgB4C,QAAhB,CAA0B;AACzBN,OADyB;AAEzBO,cAAS,KAAKf,sBAFW;AAGzBgB,WAAM,KAAK5B,0BAHc;AAIzBkB,WAAMG,OAJmB;AAKzBF,WAAMA;AALmB,KAA1B;AAOA;AACD,QAAK,YAAL;AACC,SAAKrC,UAAL,CAAgB4C,QAAhB,CAA0B;AACzBN,OADyB;AAEzBO,cAAS,KAAK1B,UAFW;AAGzB2B,WAAM,KAAK1B,cAHc;AAIzBgB,WAAMG,OAJmB;AAKzBF,WAAMA;AALmB,KAA1B;AAOA;AACD,QAAK,aAAL;AACC,SAAKrC,UAAL,CAAgB4C,QAAhB,CAA0B;AACzBN,OADyB;AAEzBO,cAAS,KAAKrB,WAFW;AAGzBsB,WAAM,KAAKrB,eAHc;AAIzBW,WAAMG;AAJmB,KAA1B;AAMA;AACD,QAAK,eAAL;AAAsB;AACrB,WAAMQ,OAAOR,QAAQQ,IAArB;AACA,SAAKA,QAAQ,KAAKjC,0BAAL,CAAiCiC,IAAjC,CAAb,EAAuD;AACtD,WAAK/C,UAAL,CAAgB4C,QAAhB,CAA0B;AACzBN,SADyB;AAEzBO,gBAAS,KAAKxB,aAFW;AAGzByB,aAAM,KAAKxB,iBAHc;AAIzBc,aAAMG,OAJmB;AAKzBF,aAAMA;AALmB,OAA1B;AAOA;AACA;AACD,UAAKf,iBAAL,CAAwBgB,EAAxB,EAA4B,EAAEU,OAAO,IAAIC,KAAJ,CAAW,2DAA2DF,IAAtE,CAAT,EAA5B;AACA;AACA;AACD;AACCG,YAAQC,IAAR,CAAc,wCAAd,EAAwDd,IAAxD;AAxDF;AA0DA;;AAED;;;;;;;;AAQA,QAAOjC,UAAP,CAAmBgD,YAAnB,EAAkC;AACjC;AACAA,iBAAeA,gBAAgB;AAC9BC,WAAQ,kBADsB;AAE9B;AACAC,gBAAa;AACZ,wBAAoB;AACnB,SAAI;AADe;AADR;AAHiB,GAA/B;;AAUA,SAAO,IAAI9G,GAAJ,CAAS4G,YAAT,CAAP;AACA;;AAED;;;;;;;AAOAG,yBAAwB;AACvB,QAAM;AACL7D,wBADK;AAELE,iBAFK;AAGLG;AAHK,MAIF,KAAKN,cAJT;;AAMA,MAAKC,0BAA0B,KAA/B,EAAuC;AACtC,UAAO,IAAP;AACA;;AAED,QAAM8D,WAAW5D,mBAAmB,IAAnB,GACd,IAAItB,0BAAJ,CAAgC,KAAK6B,KAArC,EAA4C,EAAEJ,MAAF,EAA5C,CADc,GAEd,IAAIlC,eAAJ,CAAqB,KAAKsC,KAA1B,EAAiC,EAAEJ,MAAF,EAAjC,CAFH;;AAIA,SAAOyD,QAAP;AACA;;AAED;;;;;;;AAOAC,qBAAoB;AACnB,QAAM;AACL9D,wBADK;AAELC,iBAFK;AAGLE,yBAHK;AAILD,cAJK;AAKLE;AALK,MAMF,KAAKN,cANT;;AAQA,MAAKE,0BAA0B,KAA/B,EAAuC;AACtC,UAAO,IAAP;AACA;;AAED,MAAI6D,QAAJ;;AAEA,MAAK3D,gBAAgB,IAArB,EAA4B;AAC3B2D,cAAW,IAAI1F,gBAAJ,CAAsB,KAAKqC,KAA3B,CAAX;AACA,GAFD,MAEO;AACNqD,cAAW5D,mBAAmB,IAAnB,GACR,IAAIpB,sBAAJ,CAA4B,KAAK2B,KAAjC,EAAwC,EAAEJ,QAAQA,MAAV,EAAkB2D,YAAY,KAAKrD,WAAnC,EAAxC,CADQ,GAER,IAAIzC,WAAJ,CAAiB,KAAKuC,KAAtB,EAA6B,EAAEJ,QAAQA,MAAV,EAAkB2D,YAAY,KAAKrD,WAAnC,EAA7B,CAFH;AAGA;;AAGD,MAAKP,0BAA0B/C,YAAayG,SAASG,aAAT,CAAwB,uBAAxB,CAAb,CAA/B,EAAkG;AACjGH,YAASI,aAAT,CAAwB,uBAAxB,EAAiD5E,qBAAjD;AACA;;AAED,OAAK6B,sBAAL,CAA4BpE,OAA5B,CAAqC,CAAE,EAAEsG,IAAF,EAAQc,UAAR,EAAF,KAA4B;AAChE,OAAK9G,YAAayG,SAASG,aAAT,CAAwBZ,IAAxB,CAAb,CAAL,EAAqD;AACpDS,aAASI,aAAT,CAAwBb,IAAxB,EAA8Bc,UAA9B;AACA;AACD,GAJD;;AAMA,SAAOL,QAAP;AACA;;AAED;;;;;;;AAOAM,iCAAgC;AAC/B,QAAM;AACLnE,wBADK;AAELC,iBAFK;AAGLC,cAHK;AAILE;AAJK,MAKF,KAAKN,cALT;;AAOA,MAAKE,0BAA0B,KAA/B,EAAuC;AACtC,UAAO,IAAP;AACA;;AAED,MAAI6D,QAAJ;;AAEA,MAAK3D,gBAAgB,IAArB,EAA4B;AAC3B2D,cAAW,IAAI5E,8BAAJ,CAAoC,KAAKuB,KAAzC,CAAX;AACA,GAFD,MAEO;AACNqD,cAAW5D,mBAAmB,IAAnB,GACR,IAAIrB,iCAAJ,CAAuC,KAAK4B,KAA5C,EAAmD,EAAEJ,QAAQA,MAAV,EAAkB2D,YAAY,KAAKrD,WAAnC,EAAnD,CADQ,GAER,IAAIjC,sBAAJ,CAA4B,KAAK+B,KAAjC,EAAwC,EAAEJ,QAAQA,MAAV,EAAkB2D,YAAY,KAAKrD,WAAnC,EAAxC,CAFH;AAGA;;AAED,OAAKQ,sBAAL,CAA4BpE,OAA5B,CAAqC,CAAE,EAAEsG,IAAF,EAAQc,UAAR,EAAF,KAA4B;AAChE,OAAK9G,YAAayG,SAASG,aAAT,CAAwBZ,IAAxB,CAAb,CAAL,EAAqD;AACpDS,aAASI,aAAT,CAAwBb,IAAxB,EAA8Bc,UAA9B;AACA;AACD,GAJD;;AAMA,SAAOL,QAAP;AACA;;AAED;;;;;;;;;AASAO,MAAM1B,IAAN,EAAYC,EAAZ,EAAgBC,UAAU,EAA1B,EAA+B;AAC9BpD,SAAOsD,KAAP,CAAc,6BAAd,EAA6CJ,IAA7C,EAAmDC,EAAnD,EAAuDC,OAAvD;;AAEAA,YAAUzD,YAAYkF,SAAZ,CAAuBzB,OAAvB,CAAV;;AAEA,OAAK/C,MAAL,CAAYyE,WAAZ,CAAyB;AACxB5B,OADwB;AAExBC,KAFwB;AAGxBC;AAHwB,GAAzB;AAKA;;AAED;;;;;;;;;AASA,QAAO2B,qBAAP,CAA8BC,aAA9B,EAA6CC,kBAAkB,IAA/D,EAAqEC,cAAc,IAAnF,EAA0F;AACzF,QAAM3D,cAAc,CAAE,uBAAF,EAA2B,gBAA3B,EAA6C,QAA7C,EAAuD,cAAvD,CAApB;AACA,QAAMzB,MAAM,CAAE,uBAAF,EAA2B,gBAA3B,EAA6C,aAA7C,EAA4D,wBAA5D,EAAsF,QAAtF,EAAgG,cAAhG,EAAgH,cAAhH,CAAZ;AACA,QAAMqF,oBAAoBC,OAAOC,IAAP,CAAaL,aAAb,CAA1B;;AAEA,SAAO;AACNzD,gBAAa9D,OAAQwH,eAAR,KAA6B1F,YAAa4F,iBAAb,EAAgC5D,WAAhC,CADpC;AAENzB,QAAKrC,OAAQyH,WAAR,KAAyB3F,YAAa4F,iBAAb,EAAgCrF,GAAhC;AAFxB,GAAP;AAIA;;AAED;;;;;;;;;;;;;;;;;;AAkBAyD,YAAYJ,EAAZ,EAAgB6B,aAAhB,EAAgC;AAC/B,QAAMM,SAASpF,kBAAkB6E,qBAAlB,CAAyCC,aAAzC,EAAwD,KAAK7D,gBAA7D,EAA+E,KAAKC,YAApF,CAAf;;AAEA,MAAK7D,IAAKyH,aAAL,EAAoB,cAApB,CAAL,EAA4C;AAC3C,QAAKhE,KAAL,GAAad,kBAAkBe,UAAlB,CAA8B+D,cAAcf,YAA5C,CAAb;AACA,UAAOe,cAAcf,YAArB;AACA;;AAED,MAAK1G,IAAKyH,aAAL,EAAoB,cAApB,CAAL,EAA4C;AAC3C1H,WAAS0H,cAAcO,YAAvB,EAAqC,CAAEtC,IAAF,EAAQuC,QAAR,KAAsB;AAC1D,SAAKtE,WAAL,CAAiBuE,eAAjB,CAAkCD,QAAlC,EAA4CvC,IAA5C;AACA,IAFD;AAGA,UAAO+B,cAAcO,YAArB;AACA;;AAED,MAAKhI,IAAKyH,aAAL,EAAoB,oBAApB,CAAL,EAAkD;AACjDxF,wBAAsB,EAAEkG,QAAQV,cAAcW,kBAAxB,EAAtB;AACA,UAAOX,cAAcW,kBAArB;AACA;;AAED,MAAKpI,IAAKyH,aAAL,EAAoB,UAApB,CAAL,EAAwC;AACvChF,UAAO4F,QAAP,CAAiBZ,cAAca,QAA/B,EAAyC,KAAzC;AACA,UAAOb,cAAca,QAArB;AACA;;AAED,OAAKvF,cAAL,GAAsBzC,MAAO,KAAKyC,cAAZ,EAA4B0E,aAA5B,CAAtB;;AAEA,MAAKM,OAAO/D,WAAZ,EAA0B;AACzB,QAAKJ,gBAAL,GAAwB,KAAKiD,qBAAL,EAAxB;AACA;AACD,MAAKkB,OAAOxF,GAAZ,EAAkB;AACjB,QAAKsB,YAAL,GAAoB,KAAKkD,iBAAL,EAApB;AACA,QAAKjD,uBAAL,GAA+B,KAAKsD,6BAAL,EAA/B;AACA;;AAED;AACA,OAAKvC,UAAL;;AAEA,OAAKwC,IAAL,CAAW,iBAAX,EAA8BzB,EAA9B;AACA;;AAED;;;;;;;;;AASAZ,oBAAoBqB,IAApB,EAA0Bc,UAA1B,EAAsCoB,UAAtC,EAAmD;AAClD,MAAK,CAAEnI,SAAUiG,IAAV,CAAP,EAA0B;AACzB,SAAM,IAAItE,gBAAJ,CAAsB,8CAA8CwG,UAA9C,GAA2D,6CAAjF,CAAN;AACA;;AAED,MAAK,CAAEpI,SAAUgH,UAAV,CAAP,EAAgC;AAC/B,SAAM,IAAIpF,gBAAJ,CAAsB,8CAA8CwG,UAA9C,GAC3B,qDADK,CAAN;AAEA;;AAED,MAAK,CAAEnI,SAAUmI,UAAV,CAAP,EAAgC;AAC/B,SAAM,IAAIxG,gBAAJ,CAAsB,8CAA8CwG,UAA9C,GAC3B,mDADK,CAAN;AAEA;;AAED;AACA,QAAMC,eAAeD,aAAa,GAAb,GAAmBlC,IAAxC;;AAEA,MAAK,KAAKxC,YAAL,KAAsB,IAA3B,EAAkC;AACjC,QAAKA,YAAL,CAAkBqD,aAAlB,CAAiCsB,YAAjC,EAA+CrB,UAA/C;AACA;AACD,OAAKhD,sBAAL,CAA4BsE,IAA5B,CAAkC,EAAED,YAAF,EAAgBrB,UAAhB,EAAlC;;AAEA,OAAKjC,iBAAL,CAAwBmB,IAAxB,EAA8BkC,UAA9B;;AAEA,SAAO,IAAP;AACA;;AAED;;;;;;;;;AASAtD,wBAAwBoB,IAAxB,EAA8BqC,OAA9B,EAAuCH,UAAvC,EAAoD;AACnD,MAAK,CAAEnI,SAAUiG,IAAV,CAAP,EAA0B;AACzB,SAAM,IAAItE,gBAAJ,CAAsB,2CAA2CwG,UAA3C,GAAwD,6CAA9E,CAAN;AACA;;AAED,MAAK,CAAEpI,SAAUuI,OAAV,CAAP,EAA6B;AAC5B,SAAM,IAAI3G,gBAAJ,CAAsB,2CAA2CwG,UAA3C,GAC3B,kDADK,CAAN;AAEA;;AAED,MAAK,CAAEnI,SAAUmI,UAAV,CAAP,EAAgC;AAC/B,SAAM,IAAIxG,gBAAJ,CAAsB,2CAA2CwG,UAA3C,GAC3B,mDADK,CAAN;AAEA;;AAED;AACAlC,SAAOkC,aAAa,GAAb,GAAmBlC,IAA1B;;AAEA,OAAKjC,0BAAL,CAAiCiC,IAAjC,IAA0CqC,OAA1C;AACA;;AAED;;;;;;;;;;;AAWAxD,mBAAmBmB,IAAnB,EAAyBkC,UAAzB,EAAsC;AACrC,MAAK,CAAEnI,SAAUiG,IAAV,CAAP,EAA0B;AACzB,SAAM,IAAItE,gBAAJ,CAAsB,6CAA6CwG,UAA7C,GAA0D,6CAAhF,CAAN;AACA;;AAED,MAAK,CAAEnI,SAAUmI,UAAV,CAAP,EAAgC;AAC/B,SAAM,IAAIxG,gBAAJ,CAAsB,6CAA6CwG,UAA7C,GAC3B,mDADK,CAAN;AAEA;;AAED,OAAK1D,UAAL;AACA;;AAED;;;;;AAKAA,cAAa;AACZ,OAAKtB,MAAL,GAAc,IAAd;AACA;;AAED;;;;;;;;;;;AAWAoF,WAAWtF,MAAX,EAAoB;AACnB,MAAK,KAAKN,cAAL,CAAoBM,MAApB,KAA+BA,MAApC,EAA6C;AAC5C;AACA;AACD,OAAKN,cAAL,CAAoBM,MAApB,GAA6BA,MAA7B;AACA,OAAKO,gBAAL,GAAwB,KAAKiD,qBAAL,EAAxB;AACA;;AAED;;;;;;;AAOA+B,yBAAyBC,KAAzB,EAAiC;AAChC,MAAK,KAAKtF,MAAL,KAAgB,IAArB,EAA4B;AAC3B,UAAO,IAAP;AACA;;AAED,MAAK,KAAKA,MAAL,CAAYuF,OAAZ,OAA0BD,MAAMC,OAAN,EAA/B,EAAiD;AAChD,UAAO,IAAP;AACA;;AAED,SAAO,KAAKvF,MAAL,CAAYwF,SAAZ,OAA4BF,MAAME,SAAN,EAAnC;AACA;;AAED;;;;;;;;;;AAUAC,iBAAiBC,GAAjB,EAAsB,EAAEC,OAAF,EAAWC,QAAX,EAAtB,EAA8C;AAC7C,MAAK9I,YAAa,KAAKmD,gBAAL,CAAuByF,GAAvB,CAAb,CAAL,EAAmD;AAClD,UAAO,IAAP;AACA;;AAED,MAAK,KAAKzF,gBAAL,CAAuByF,GAAvB,EAA6BC,OAA7B,KAAyCA,OAA9C,EAAwD;AACvD,UAAO,IAAP;AACA;;AAED,SAAO,KAAK1F,gBAAL,CAAuByF,GAAvB,EAA6BE,QAA7B,KAA0CA,QAAjD;AACA;;AAED;;;;;;;;;;;;;;;AAeA9E,SAASuB,EAAT,EAAa,EAAEiD,KAAF,EAASO,kBAAkB,EAA3B,EAAb,EAA+C;AAC9C;AACAP,QAAMQ,KAAN,GAAcxJ,MAAOgJ,MAAMQ,KAAb,CAAd;AACAR,QAAMQ,KAAN,GAAcxI,OAAOyI,gBAAP,CAAyBT,MAAMQ,KAA/B,CAAd;AACA,QAAME,kBAAkB,KAAKhG,MAAL,KAAgB,IAAhB,IAAwB,CAAE,KAAKA,MAAL,CAAYiG,MAAZ,CAAoBX,KAApB,CAAlD;AACA,QAAMD,0BAA0B,KAAKA,uBAAL,CAA8BC,KAA9B,CAAhC;;AAEA,MAAKU,eAAL,EAAuB;AACtB,QAAKhG,MAAL,GAAcsF,KAAd;AACA,QAAKlF,WAAL,CAAiB8F,QAAjB,CAA2B,KAAKlG,MAAhC;;AAEA;AACA,QAAKoF,SAAL,CAAgB,KAAKpF,MAAL,CAAYwF,SAAZ,EAAhB;AACA;;AAED,MAAK,KAAKhG,cAAL,CAAoBE,qBAApB,IAA6C,KAAKY,YAAvD,EAAsE;AACrE,OAAK0F,eAAL,EAAuB;AACtB,SAAK1F,YAAL,CAAkB6F,MAAlB,CAA0B,KAAKnG,MAA/B;;AAEA;AACA,SAAKQ,QAAL,CAAcxB,GAAd,GAAoB,EAApB;AACA,SAAKwB,QAAL,CAAcxB,GAAd,CAAmB,EAAnB,IAA0B;AACzB0B,cAAS,KAAKJ,YAAL,CAAkBI,OADF;AAEzBC,YAAO,KAAKL,YAAL,CAAkB8F,qBAAlB;AAFkB,KAA1B;AAIA;;AAED;AACA,SAAMC,8BAA8B,CAAE,EAAF,CAApC;AACA7J,WAASqJ,eAAT,EAA0B,CAAES,cAAF,EAAkBZ,GAAlB,KAA2B;AACpDW,gCAA4BnB,IAA5B,CAAkCQ,GAAlC;;AAEA,SAAKzF,gBAAL,CAAuByF,GAAvB,IAA+BY,cAA/B;;AAEA,UAAMC,eAAetI,MAAMsE,KAAN,cACjB,KAAKvC,MAAL,CAAY+D,SAAZ,EADiB;AAEpB4B,cAAS,KAAK1F,gBAAL,CAAuByF,GAAvB,EAA6BC,OAFlB;AAGpBC,eAAU,KAAK3F,gBAAL,CAAuByF,GAAvB,EAA6BE;AAHnB,OAArB;;AAMA,SAAKrF,uBAAL,CAA6B4F,MAA7B,CAAqCI,YAArC;;AAEA,SAAK/F,QAAL,CAAcxB,GAAd,CAAmB0G,GAAnB,IAA2B;AAC1BhF,cAAS,KAAKH,uBAAL,CAA6BG,OADZ;AAE1BC,YAAO,KAAKJ,uBAAL,CAA6B6F,qBAA7B;AAFmB,KAA3B;AAIA,IAjBD;;AAmBA;AACA,OAAKC,4BAA4BG,MAA5B,GAAqC,CAA1C,EAA8C;AAC7C,SAAKhG,QAAL,CAAcxB,GAAd,GAAoBhC,OAAQ,KAAKwD,QAAL,CAAcxB,GAAtB,EAA2B,CAAEsH,cAAF,EAAkBZ,GAAlB,KAA2BhJ,SAAU2J,2BAAV,EAAuCX,GAAvC,CAAtD,CAApB;AACA;AACD;;AAED,MAAK,KAAKlG,cAAL,CAAoBC,qBAApB,IAA6C,KAAKY,gBAAlD,IAAsEgF,uBAA3E,EAAqG;AACpG,QAAKhF,gBAAL,CAAsB8F,MAAtB,CAA8B,KAAKnG,MAAnC;;AAEA,QAAKQ,QAAL,CAAcC,WAAd,GAA4B;AAC3BC,aAAS,KAAKL,gBAAL,CAAsBK,OADJ;AAE3BC,WAAO,KAAKN,gBAAL,CAAsB+F,qBAAtB;AAFoB,IAA5B;AAIA;;AAED,SAAO,KAAK5F,QAAZ;AACA;;AAED;;;;;;;;AAQAU,YAAYmB,EAAZ,EAAgB,EAAEoE,GAAF,EAAhB,EAA0B;AACzB,MAAK3J,YAAa2J,GAAb,CAAL,EAA0B;AACzB,UAAO,EAAEC,QAAQ,KAAV,EAAiBD,GAAjB,EAAsBE,SAAS,wCAA/B,EAAP;AACA;;AAED,MAAI;AACH,QAAKpH,MAAL,CAAYqH,aAAZ,CAA2BH,GAA3B;AACA,GAFD,CAEE,OAAQ1D,KAAR,EAAgB;AACjB,UAAO,EAAE2D,QAAQ,KAAV,EAAiBD,GAAjB,EAAsBE,SAAS5D,MAAM4D,OAArC,EAAP;AACA;;AAED,SAAO,EAAED,QAAQ,IAAV,EAAgBD,GAAhB,EAAP;AACA;;AAED;;;;;;;;AAQAtF,gBAAgBkB,EAAhB,EAAoBwE,MAApB,EAA6B;AAC5B,MAAK,CAAEA,OAAOH,MAAd,EAAuB;AACtB,QAAK5C,IAAL,CAAW,mBAAX,EAAgCzB,EAAhC,EAAoCwE,MAApC;AACA;AACA;;AAED,OAAK/C,IAAL,CAAW,iBAAX,EAA8BzB,EAA9B,EAAkCwE,MAAlC;AACA;;AAED;;;;;;;;AAQA7F,aAAaqB,EAAb,EAAiBwE,MAAjB,EAA0B;AACzB,MAAKA,OAAO9D,KAAZ,EAAoB;AACnB,QAAKe,IAAL,CAAW,gBAAX,EAA6BzB,EAA7B,EAAiCwE,MAAjC;AACA;AACA;AACD,OAAK/C,IAAL,CAAW,cAAX,EAA2BzB,EAA3B,EAA+BwE,MAA/B;AACA;;AAED;;;;;;;;AAQA5F,4BAA4BoB,EAA5B,EAAgCwE,MAAhC,EAAyC;AACxC,MAAKA,OAAO9D,KAAZ,EAAoB;AACnB,QAAKe,IAAL,CAAW,+BAAX,EAA4CzB,EAA5C,EAAgDwE,MAAhD;AACA;AACA;AACD,OAAK/C,IAAL,CAAW,6BAAX,EAA0CzB,EAA1C,EAA8CwE,MAA9C;AACA;;AAED;;;;;;;;;AASAzF,eAAeiB,EAAf,EAAmB,EAAES,IAAF,EAAQX,IAAR,EAAnB,EAAoC;AACnC,MAAI;AACH,UAAO;AACN2E,aAAS,IADH;AAEN3E,UAAM,KAAKtB,0BAAL,CAAiCiC,IAAjC,EAAyCX,IAAzC;AAFA,IAAP;AAIA,GALD,CAKE,OAAQY,KAAR,EAAgB;AACjB,UAAO,EAAEA,KAAF,EAAP;AACA;AACD;;AAED;;;;;;;;AAQA1B,mBAAmBgB,EAAnB,EAAuBwE,MAAvB,EAAgC;AAC/B,MAAKA,OAAOC,OAAZ,EAAsB;AACrB,QAAKhD,IAAL,CAAW,oBAAX,EAAiCzB,EAAjC,EAAqCwE,OAAO1E,IAA5C;AACA;AACA;AACD,OAAK2B,IAAL,CAAW,sBAAX,EAAmC+C,OAAO9D,KAA1C;AACA;;AAED;;;;;;;;;;AAUAxB,aAAac,EAAb,EAAiB,EAAES,IAAF,EAAQwC,QAAQ,IAAhB,EAAjB,EAA0C;AACzC;AACA,QAAM7B,aAAa6B,UAAU,IAAV,GAChB,KAAKlF,WADW,GAEhB,IAAIrC,UAAJ,CAAgBuH,KAAhB,CAFH;;AAIA,SAAO7B,WAAWsD,WAAX,CAAwBjE,IAAxB,CAAP;AACA;;AAED;;;;;;;;AAQAtB,iBAAiBa,EAAjB,EAAqBwE,MAArB,EAA8B;AAC7B,MAAKA,OAAO9D,KAAZ,EAAoB;AACnB,QAAKe,IAAL,CAAW,oBAAX,EAAiCzB,EAAjC,EAAqCwE,MAArC;AACA;AACA;AACD,OAAK/C,IAAL,CAAW,kBAAX,EAA+BzB,EAA/B,EAAmCwE,MAAnC;AACA;AA7xBqC","file":"AnalysisWebWorker.js","sourcesContent":["// External dependencies.\nimport { autop } from \"@wordpress/autop\";\nimport Jed from \"jed\";\nimport { forEach, has, includes, isNull, isObject, isString, isUndefined, merge, pickBy } from \"lodash-es\";\nimport { getLogger } from \"loglevel\";\n\n// YoastSEO.js dependencies.\nimport * as assessments from \"../assessments\";\nimport * as bundledPlugins from \"../bundledPlugins\";\nimport * as helpers from \"../helpers\";\nimport * as markers from \"../markers\";\nimport * as string from \"../stringProcessing\";\nimport * as interpreters from \"../interpreters\";\nimport * as config from \"../config\";\n\nimport Assessor from \"../assessor\";\nimport Assessment from \"../assessment\";\nimport SEOAssessor from \"../seoAssessor\";\nimport ContentAssessor from \"../contentAssessor\";\nimport TaxonomyAssessor from \"../taxonomyAssessor\";\nimport Pluggable from \"../pluggable\";\nimport Researcher from \"../researcher\";\nimport SnippetPreview from \"../snippetPreview\";\nimport Paper from \"../values/Paper\";\nimport AssessmentResult from \"../values/AssessmentResult\";\nimport RelatedKeywordAssessor from \"../relatedKeywordAssessor\";\n\nconst YoastSEO = {\n\tAssessor,\n\tAssessment,\n\tSEOAssessor,\n\tContentAssessor,\n\tTaxonomyAssessor,\n\tPluggable,\n\tResearcher,\n\tSnippetPreview,\n\tRelatedKeywordAssessor,\n\n\tPaper,\n\tAssessmentResult,\n\n\tassessments,\n\tbundledPlugins,\n\thelpers,\n\tmarkers,\n\tstring,\n\tinterpreters,\n\tconfig,\n};\n\n// Internal dependencies.\nimport CornerstoneContentAssessor from \"../cornerstone/contentAssessor\";\nimport CornerstoneRelatedKeywordAssessor from \"../cornerstone/relatedKeywordAssessor\";\nimport CornerstoneSEOAssessor from \"../cornerstone/seoAssessor\";\nimport InvalidTypeError from \"../errors/invalidType\";\nimport includesAny from \"../helpers/includesAny\";\nimport { configureShortlinker } from \"../helpers/shortlinker\";\nimport RelatedKeywordTaxonomyAssessor from \"../relatedKeywordTaxonomyAssessor\";\nimport Scheduler from \"./scheduler\";\nimport Transporter from \"./transporter\";\nimport wrapTryCatchAroundAction from \"./wrapTryCatchAroundAction\";\n\n\nconst keyphraseDistribution = new assessments.seo.KeyphraseDistributionAssessment();\n\nconst logger = getLogger( \"yoast-analysis-worker\" );\nlogger.setDefaultLevel( \"error\" );\n\n/**\n * Analysis Web Worker.\n *\n * Worker API:     https://developer.mozilla.org/en-US/docs/Web/API/Worker\n * Webpack loader: https://github.com/webpack-contrib/worker-loader\n */\nexport default class AnalysisWebWorker {\n\t/**\n\t * Initializes the AnalysisWebWorker class.\n\t *\n\t * @param {Object} scope The scope for the messaging. Expected to have the\n\t *                       `onmessage` event and the `postMessage` function.\n\t */\n\tconstructor( scope ) {\n\t\tthis._scope = scope;\n\n\t\tthis._configuration = {\n\t\t\tcontentAnalysisActive: true,\n\t\t\tkeywordAnalysisActive: true,\n\t\t\tuseCornerstone: false,\n\t\t\tuseTaxonomy: false,\n\t\t\tuseKeywordDistribution: false,\n\t\t\t// The locale used for language-specific configurations in Flesch-reading ease and Sentence length assessments.\n\t\t\tlocale: \"en_US\",\n\t\t};\n\n\t\tthis._scheduler = new Scheduler();\n\n\t\tthis._paper = null;\n\t\tthis._relatedKeywords = {};\n\n\t\tthis._i18n = AnalysisWebWorker.createI18n();\n\t\tthis._researcher = new Researcher( this._paper );\n\n\t\tthis._contentAssessor = null;\n\t\tthis._seoAssessor = null;\n\t\tthis._relatedKeywordAssessor = null;\n\n\t\t/*\n\t\t * The cached analyses results.\n\t\t *\n\t\t * A single result has the following structure:\n\t\t * {AssessmentResult[]} readability.results An array of assessment results; in serialized format.\n\t\t * {number}             readability.score   The overall score.\n\t\t *\n\t\t * The results have the following structure.\n\t\t * {Object} readability Content assessor results.\n\t\t * {Object} seo         SEO assessor results, per keyword identifier or empty string for the main.\n\t\t * {Object} seo[ \"\" ]   The result of the paper analysis for the main keyword.\n\t\t * {Object} seo[ key ]  Same as above, but instead for a related keyword.\n\t\t */\n\t\tthis._results = {\n\t\t\treadability: {\n\t\t\t\tresults: [],\n\t\t\t\tscore: 0,\n\t\t\t},\n\t\t\tseo: {\n\t\t\t\t\"\": {\n\t\t\t\t\tresults: [],\n\t\t\t\t\tscore: 0,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t\tthis._registeredAssessments = [];\n\t\tthis._registeredMessageHandlers = {};\n\n\t\t// Bind actions to this scope.\n\t\tthis.analyze = this.analyze.bind( this );\n\t\tthis.analyzeDone = this.analyzeDone.bind( this );\n\t\tthis.analyzeRelatedKeywordsDone = this.analyzeRelatedKeywordsDone.bind( this );\n\t\tthis.loadScript = this.loadScript.bind( this );\n\t\tthis.loadScriptDone = this.loadScriptDone.bind( this );\n\t\tthis.customMessage = this.customMessage.bind( this );\n\t\tthis.customMessageDone = this.customMessageDone.bind( this );\n\t\tthis.clearCache = this.clearCache.bind( this );\n\t\tthis.runResearch = this.runResearch.bind( this );\n\t\tthis.runResearchDone = this.runResearchDone.bind( this );\n\n\t\t// Bind register functions to this scope.\n\t\tthis.registerAssessment = this.registerAssessment.bind( this );\n\t\tthis.registerMessageHandler = this.registerMessageHandler.bind( this );\n\t\tthis.refreshAssessment = this.refreshAssessment.bind( this );\n\n\t\t// Bind event handlers to this scope.\n\t\tthis.handleMessage = this.handleMessage.bind( this );\n\n\t\t// Wrap try/catch around actions.\n\t\tthis.analyzeRelatedKeywords =\n\t\t\twrapTryCatchAroundAction( logger, this.analyze, \"An error occurred while running the related keywords analysis.\" );\n\t\t/*\n\t\t * Overwrite this.analyze after we use it in this.analyzeRelatedKeywords so that this.analyzeRelatedKeywords\n\t\t * doesn't use the overwritten version. Therefore, this order shouldn't be changed.\n\t\t */\n\t\tthis.analyze = wrapTryCatchAroundAction( logger, this.analyze, \"An error occurred while running the analysis.\" );\n\t\tthis.runResearch = wrapTryCatchAroundAction( logger, this.runResearch,\n\t\t\t\"An error occurred after running the '%%name%%' research.\" );\n\t}\n\n\t/**\n\t * Registers this web worker with the scope passed to it's constructor.\n\t *\n\t * @returns {void}\n\t */\n\tregister() {\n\t\tthis._scope.onmessage = this.handleMessage;\n\t\tthis._scope.analysisWorker = {\n\t\t\tregisterAssessment: this.registerAssessment,\n\t\t\tregisterMessageHandler: this.registerMessageHandler,\n\t\t\trefreshAssessment: this.refreshAssessment,\n\t\t};\n\t\tthis._scope.yoast = this._scope.yoast || {};\n\t\tthis._scope.yoast.analysis = YoastSEO;\n\t}\n\n\t/**\n\t * Receives the post message and determines the action.\n\t *\n\t * See: https://developer.mozilla.org/en-US/docs/Web/API/Worker/onmessage\n\t *\n\t * @param {MessageEvent} event              The post message event.\n\t * @param {Object}       event.data         The data object.\n\t * @param {string}       event.data.type    The action type.\n\t * @param {string}       event.data.id      The request id.\n\t * @param {string}       event.data.payload The payload of the action.\n\t *\n\t * @returns {void}\n\t */\n\thandleMessage( { data: { type, id, payload } } ) {\n\t\tpayload = Transporter.parse( payload );\n\n\t\tlogger.debug( \"AnalysisWebWorker incoming:\", type, id, payload );\n\n\t\tswitch ( type ) {\n\t\t\tcase \"initialize\":\n\t\t\t\tthis.initialize( id, payload );\n\t\t\t\tthis._scheduler.startPolling();\n\t\t\t\tbreak;\n\t\t\tcase \"analyze\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.analyze,\n\t\t\t\t\tdone: this.analyzeDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t\ttype: type,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"analyzeRelatedKeywords\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.analyzeRelatedKeywords,\n\t\t\t\t\tdone: this.analyzeRelatedKeywordsDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t\ttype: type,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"loadScript\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.loadScript,\n\t\t\t\t\tdone: this.loadScriptDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t\ttype: type,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"runResearch\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.runResearch,\n\t\t\t\t\tdone: this.runResearchDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"customMessage\": {\n\t\t\t\tconst name = payload.name;\n\t\t\t\tif ( name && this._registeredMessageHandlers[ name ] ) {\n\t\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\texecute: this.customMessage,\n\t\t\t\t\t\tdone: this.customMessageDone,\n\t\t\t\t\t\tdata: payload,\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.customMessageDone( id, { error: new Error( \"No message handler registered for messages with name: \" + name ) } );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tconsole.warn( \"AnalysisWebWorker unrecognized action:\", type );\n\t\t}\n\t}\n\n\t/**\n\t * Initializes i18n object based on passed configuration.\n\t *\n\t * @param {Object} [translations] The translations to be used in the current\n\t *                                instance.\n\t *\n\t * @returns {Jed} Jed instance.\n\t */\n\tstatic createI18n( translations ) {\n\t\t// Use default object to prevent Jed from erroring out.\n\t\ttranslations = translations || {\n\t\t\tdomain: \"js-text-analysis\",\n\t\t\t// eslint-disable-next-line camelcase\n\t\t\tlocale_data: {\n\t\t\t\t\"js-text-analysis\": {\n\t\t\t\t\t\"\": {},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn new Jed( translations );\n\t}\n\n\t/**\n\t * Initializes the appropriate content assessor.\n\t *\n\t * @returns {null|ContentAssessor|CornerstoneContentAssessor} The chosen\n\t *                                                            content\n\t *                                                            assessor.\n\t */\n\tcreateContentAssessor() {\n\t\tconst {\n\t\t\tcontentAnalysisActive,\n\t\t\tuseCornerstone,\n\t\t\tlocale,\n\t\t} = this._configuration;\n\n\t\tif ( contentAnalysisActive === false ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst assessor = useCornerstone === true\n\t\t\t? new CornerstoneContentAssessor( this._i18n, { locale } )\n\t\t\t: new ContentAssessor( this._i18n, { locale } );\n\n\t\treturn assessor;\n\t}\n\n\t/**\n\t * Initializes the appropriate SEO assessor.\n\t *\n\t * @returns {null|SEOAssessor|CornerstoneSEOAssessor|TaxonomyAssessor} The chosen\n\t *                                                                     SEO\n\t *                                                                     assessor.\n\t */\n\tcreateSEOAssessor() {\n\t\tconst {\n\t\t\tkeywordAnalysisActive,\n\t\t\tuseCornerstone,\n\t\t\tuseKeywordDistribution,\n\t\t\tuseTaxonomy,\n\t\t\tlocale,\n\t\t} = this._configuration;\n\n\t\tif ( keywordAnalysisActive === false ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet assessor;\n\n\t\tif ( useTaxonomy === true ) {\n\t\t\tassessor = new TaxonomyAssessor( this._i18n );\n\t\t} else {\n\t\t\tassessor = useCornerstone === true\n\t\t\t\t? new CornerstoneSEOAssessor( this._i18n, { locale: locale, researcher: this._researcher } )\n\t\t\t\t: new SEOAssessor( this._i18n, { locale: locale, researcher: this._researcher } );\n\t\t}\n\n\n\t\tif ( useKeywordDistribution && isUndefined( assessor.getAssessment( \"keyphraseDistribution\" ) ) ) {\n\t\t\tassessor.addAssessment( \"keyphraseDistribution\", keyphraseDistribution );\n\t\t}\n\n\t\tthis._registeredAssessments.forEach( ( { name, assessment } ) => {\n\t\t\tif ( isUndefined( assessor.getAssessment( name ) ) ) {\n\t\t\t\tassessor.addAssessment( name, assessment );\n\t\t\t}\n\t\t} );\n\n\t\treturn assessor;\n\t}\n\n\t/**\n\t * Initializes the appropriate SEO assessor for related keywords.\n\t *\n\t * @returns {null|SEOAssessor|CornerstoneSEOAssessor|TaxonomyAssessor} The chosen\n\t *                                                                     related keywords\n\t *                                                                     assessor.\n\t */\n\tcreateRelatedKeywordsAssessor() {\n\t\tconst {\n\t\t\tkeywordAnalysisActive,\n\t\t\tuseCornerstone,\n\t\t\tuseTaxonomy,\n\t\t\tlocale,\n\t\t} = this._configuration;\n\n\t\tif ( keywordAnalysisActive === false ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet assessor;\n\n\t\tif ( useTaxonomy === true ) {\n\t\t\tassessor = new RelatedKeywordTaxonomyAssessor( this._i18n );\n\t\t} else {\n\t\t\tassessor = useCornerstone === true\n\t\t\t\t? new CornerstoneRelatedKeywordAssessor( this._i18n, { locale: locale, researcher: this._researcher } )\n\t\t\t\t: new RelatedKeywordAssessor( this._i18n, { locale: locale, researcher: this._researcher } );\n\t\t}\n\n\t\tthis._registeredAssessments.forEach( ( { name, assessment } ) => {\n\t\t\tif ( isUndefined( assessor.getAssessment( name ) ) ) {\n\t\t\t\tassessor.addAssessment( name, assessment );\n\t\t\t}\n\t\t} );\n\n\t\treturn assessor;\n\t}\n\n\t/**\n\t * Sends a message.\n\t *\n\t * @param {string} type      The message type.\n\t * @param {number} id        The request id.\n\t * @param {Object} [payload] The payload to deliver.\n\t *\n\t * @returns {void}\n\t */\n\tsend( type, id, payload = {} ) {\n\t\tlogger.debug( \"AnalysisWebWorker outgoing:\", type, id, payload );\n\n\t\tpayload = Transporter.serialize( payload );\n\n\t\tthis._scope.postMessage( {\n\t\t\ttype,\n\t\t\tid,\n\t\t\tpayload,\n\t\t} );\n\t}\n\n\t/**\n\t * Checks which assessors should update giving a configuration.\n\t *\n\t * @param {Object}   configuration          The configuration to check.\n\t * @param {Assessor} [contentAssessor=null] The content assessor.\n\t * @param {Assessor} [seoAssessor=null]     The SEO assessor.\n\t *\n\t * @returns {Object} Containing seo and readability with true or false.\n\t */\n\tstatic shouldAssessorsUpdate( configuration, contentAssessor = null, seoAssessor = null ) {\n\t\tconst readability = [ \"contentAnalysisActive\", \"useCornerstone\", \"locale\", \"translations\" ];\n\t\tconst seo = [ \"keywordAnalysisActive\", \"useCornerstone\", \"useTaxonomy\", \"useKeywordDistribution\", \"locale\", \"translations\", \"researchData\" ];\n\t\tconst configurationKeys = Object.keys( configuration );\n\n\t\treturn {\n\t\t\treadability: isNull( contentAssessor ) || includesAny( configurationKeys, readability ),\n\t\t\tseo: isNull( seoAssessor ) || includesAny( configurationKeys, seo ),\n\t\t};\n\t}\n\n\t/**\n\t * Configures the analysis worker.\n\t *\n\t * @param {number}  id                                     The request id.\n\t * @param {Object}  configuration                          The configuration object.\n\t * @param {boolean} [configuration.contentAnalysisActive]  Whether the content analysis is active.\n\t * @param {boolean} [configuration.keywordAnalysisActive]  Whether the keyword analysis is active.\n\t * @param {boolean} [configuration.useCornerstone]         Whether the paper is cornerstone or not.\n\t * @param {boolean} [configuration.useTaxonomy]            Whether the taxonomy assessor should be used.\n\t * @param {boolean} [configuration.useKeywordDistribution] Whether the keyphraseDistribution assessment should run.\n\t * @param {string}  [configuration.locale]                 The locale used in the seo assessor.\n\t * @param {Object}  [configuration.translations]           The translation strings.\n\t * @param {Object}  [configuration.researchData]           Extra research data.\n\t * @param {Object}  [configuration.defaultQueryParams]     The default query params for the Shortlinker.\n\t * @param {string}  [configuration.logLevel]               Log level, see: https://github.com/pimterry/loglevel#documentation\n\t *\n\t * @returns {void}\n\t */\n\tinitialize( id, configuration ) {\n\t\tconst update = AnalysisWebWorker.shouldAssessorsUpdate( configuration, this._contentAssessor, this._seoAssessor );\n\n\t\tif ( has( configuration, \"translations\" ) ) {\n\t\t\tthis._i18n = AnalysisWebWorker.createI18n( configuration.translations );\n\t\t\tdelete configuration.translations;\n\t\t}\n\n\t\tif ( has( configuration, \"researchData\" ) ) {\n\t\t\tforEach( configuration.researchData, ( data, research ) => {\n\t\t\t\tthis._researcher.addResearchData( research, data );\n\t\t\t} );\n\t\t\tdelete configuration.researchData;\n\t\t}\n\n\t\tif ( has( configuration, \"defaultQueryParams\" ) ) {\n\t\t\tconfigureShortlinker( { params: configuration.defaultQueryParams } );\n\t\t\tdelete configuration.defaultQueryParams;\n\t\t}\n\n\t\tif ( has( configuration, \"logLevel\" ) ) {\n\t\t\tlogger.setLevel( configuration.logLevel, false );\n\t\t\tdelete configuration.logLevel;\n\t\t}\n\n\t\tthis._configuration = merge( this._configuration, configuration );\n\n\t\tif ( update.readability ) {\n\t\t\tthis._contentAssessor = this.createContentAssessor();\n\t\t}\n\t\tif ( update.seo ) {\n\t\t\tthis._seoAssessor = this.createSEOAssessor();\n\t\t\tthis._relatedKeywordAssessor = this.createRelatedKeywordsAssessor();\n\t\t}\n\n\t\t// Reset the paper in order to not use the cached results on analyze.\n\t\tthis.clearCache();\n\n\t\tthis.send( \"initialize:done\", id );\n\t}\n\n\t/**\n\t * Register an assessment for a specific plugin.\n\t *\n\t * @param {string}   name       The name of the assessment.\n\t * @param {function} assessment The function to run as an assessment.\n\t * @param {string}   pluginName The name of the plugin associated with the assessment.\n\t *\n\t * @returns {boolean} Whether registering the assessment was successful.\n\t */\n\tregisterAssessment( name, assessment, pluginName ) {\n\t\tif ( ! isString( name ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register assessment for plugin \" + pluginName + \". Expected parameter `name` to be a string.\" );\n\t\t}\n\n\t\tif ( ! isObject( assessment ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register assessment for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `assessment` to be a function.\" );\n\t\t}\n\n\t\tif ( ! isString( pluginName ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register assessment for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `pluginName` to be a string.\" );\n\t\t}\n\n\t\t// Prefix the name with the pluginName so the test name is always unique.\n\t\tconst combinedName = pluginName + \"-\" + name;\n\n\t\tif ( this._seoAssessor !== null ) {\n\t\t\tthis._seoAssessor.addAssessment( combinedName, assessment );\n\t\t}\n\t\tthis._registeredAssessments.push( { combinedName, assessment } );\n\n\t\tthis.refreshAssessment( name, pluginName );\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Register a message handler for a specific plugin.\n\t *\n\t * @param {string}   name       The name of the message handler.\n\t * @param {function} handler    The function to run as an message handler.\n\t * @param {string}   pluginName The name of the plugin associated with the message handler.\n\t *\n\t * @returns {boolean} Whether registering the message handler was successful.\n\t */\n\tregisterMessageHandler( name, handler, pluginName ) {\n\t\tif ( ! isString( name ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register handler for plugin \" + pluginName + \". Expected parameter `name` to be a string.\" );\n\t\t}\n\n\t\tif ( ! isObject( handler ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register handler for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `handler` to be a function.\" );\n\t\t}\n\n\t\tif ( ! isString( pluginName ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register handler for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `pluginName` to be a string.\" );\n\t\t}\n\n\t\t// Prefix the name with the pluginName so the test name is always unique.\n\t\tname = pluginName + \"-\" + name;\n\n\t\tthis._registeredMessageHandlers[ name ] = handler;\n\t}\n\n\t/**\n\t * Refreshes an assessment in the analysis.\n\t *\n\t * Custom assessments can use this to mark their assessment as needing a\n\t * refresh.\n\t *\n\t * @param {string} name The name of the assessment.\n\t * @param {string} pluginName The name of the plugin associated with the assessment.\n\t *\n\t * @returns {boolean} Whether refreshing the assessment was successful.\n\t */\n\trefreshAssessment( name, pluginName ) {\n\t\tif ( ! isString( name ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to refresh assessment for plugin \" + pluginName + \". Expected parameter `name` to be a string.\" );\n\t\t}\n\n\t\tif ( ! isString( pluginName ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to refresh assessment for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `pluginName` to be a string.\" );\n\t\t}\n\n\t\tthis.clearCache();\n\t}\n\n\t/**\n\t * Clears the worker cache to force a new analysis.\n\t *\n\t * @returns {void}\n\t */\n\tclearCache() {\n\t\tthis._paper = null;\n\t}\n\n\t/**\n\t * Changes the locale in the configuration.\n\t *\n\t * If the locale is different:\n\t * - Update the configuration locale.\n\t * - Create the content assessor.\n\t *\n\t * @param {string} locale The locale to set.\n\t *\n\t * @returns {void}\n\t */\n\tsetLocale( locale ) {\n\t\tif ( this._configuration.locale === locale ) {\n\t\t\treturn;\n\t\t}\n\t\tthis._configuration.locale = locale;\n\t\tthis._contentAssessor = this.createContentAssessor();\n\t}\n\n\t/**\n\t * Checks if the paper contains changes that are used for readability.\n\t *\n\t * @param {Paper} paper The paper to check against the cached paper.\n\t *\n\t * @returns {boolean} True if there are changes detected.\n\t */\n\tshouldReadabilityUpdate( paper ) {\n\t\tif ( this._paper === null ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( this._paper.getText() !== paper.getText() ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this._paper.getLocale() !== paper.getLocale();\n\t}\n\n\t/**\n\t * Checks if the related keyword contains changes that are used for seo.\n\t *\n\t * @param {string} key                     The identifier of the related keyword.\n\t * @param {Object} relatedKeyword          The related keyword object.\n\t * @param {string} relatedKeyword.keyword  The keyword.\n\t * @param {string} relatedKeyword.synonyms The synonyms.\n\t *\n\t * @returns {boolean} True if there are changes detected.\n\t */\n\tshouldSeoUpdate( key, { keyword, synonyms } ) {\n\t\tif ( isUndefined( this._relatedKeywords[ key ] ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( this._relatedKeywords[ key ].keyword !== keyword ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this._relatedKeywords[ key ].synonyms !== synonyms;\n\t}\n\n\t/**\n\t * Runs analyses on a paper.\n\t *\n\t * The paper includes the keyword and synonyms data. However, this is\n\t * possibly just one instance of these. From here we are going to split up\n\t * this data and keep track of the different sets of keyword-synonyms and\n\t * their results.\n\t *\n\t * @param {number} id                        The request id.\n\t * @param {Object} payload                   The payload object.\n\t * @param {Object} payload.paper             The paper to analyze.\n\t * @param {Object} [payload.relatedKeywords] The related keywords.\n\t *\n\t * @returns {Object} The result, may not contain readability or seo.\n\t */\n\tanalyze( id, { paper, relatedKeywords = {} } ) {\n\t\t// Automatically add paragraph tags, like Wordpress does, on blocks padded by double newlines or html elements.\n\t\tpaper._text = autop( paper._text );\n\t\tpaper._text = string.removeHtmlBlocks( paper._text );\n\t\tconst paperHasChanges = this._paper === null || ! this._paper.equals( paper );\n\t\tconst shouldReadabilityUpdate = this.shouldReadabilityUpdate( paper );\n\n\t\tif ( paperHasChanges ) {\n\t\t\tthis._paper = paper;\n\t\t\tthis._researcher.setPaper( this._paper );\n\n\t\t\t// Update the configuration locale to the paper locale.\n\t\t\tthis.setLocale( this._paper.getLocale() );\n\t\t}\n\n\t\tif ( this._configuration.keywordAnalysisActive && this._seoAssessor ) {\n\t\t\tif ( paperHasChanges ) {\n\t\t\t\tthis._seoAssessor.assess( this._paper );\n\n\t\t\t\t// Reset the cached results for the related keywords here too.\n\t\t\t\tthis._results.seo = {};\n\t\t\t\tthis._results.seo[ \"\" ] = {\n\t\t\t\t\tresults: this._seoAssessor.results,\n\t\t\t\t\tscore: this._seoAssessor.calculateOverallScore(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Start an analysis for every related keyword.\n\t\t\tconst requestedRelatedKeywordKeys = [ \"\" ];\n\t\t\tforEach( relatedKeywords, ( relatedKeyword, key ) => {\n\t\t\t\trequestedRelatedKeywordKeys.push( key );\n\n\t\t\t\tthis._relatedKeywords[ key ] = relatedKeyword;\n\n\t\t\t\tconst relatedPaper = Paper.parse( {\n\t\t\t\t\t...this._paper.serialize(),\n\t\t\t\t\tkeyword: this._relatedKeywords[ key ].keyword,\n\t\t\t\t\tsynonyms: this._relatedKeywords[ key ].synonyms,\n\t\t\t\t} );\n\n\t\t\t\tthis._relatedKeywordAssessor.assess( relatedPaper );\n\n\t\t\t\tthis._results.seo[ key ] = {\n\t\t\t\t\tresults: this._relatedKeywordAssessor.results,\n\t\t\t\t\tscore: this._relatedKeywordAssessor.calculateOverallScore(),\n\t\t\t\t};\n\t\t\t} );\n\n\t\t\t// Clear the unrequested results, but only if there are requested related keywords.\n\t\t\tif ( requestedRelatedKeywordKeys.length > 1 ) {\n\t\t\t\tthis._results.seo = pickBy( this._results.seo, ( relatedKeyword, key ) => includes( requestedRelatedKeywordKeys, key ) );\n\t\t\t}\n\t\t}\n\n\t\tif ( this._configuration.contentAnalysisActive && this._contentAssessor && shouldReadabilityUpdate ) {\n\t\t\tthis._contentAssessor.assess( this._paper );\n\n\t\t\tthis._results.readability = {\n\t\t\t\tresults: this._contentAssessor.results,\n\t\t\t\tscore: this._contentAssessor.calculateOverallScore(),\n\t\t\t};\n\t\t}\n\n\t\treturn this._results;\n\t}\n\n\t/**\n\t * Loads a new script from an external source.\n\t *\n\t * @param {number} id  The request id.\n\t * @param {string} url The url of the script to load;\n\t *\n\t * @returns {Object} An object containing whether or not the url was loaded, the url and possibly an error message.\n\t */\n\tloadScript( id, { url } ) {\n\t\tif ( isUndefined( url ) ) {\n\t\t\treturn { loaded: false, url, message: \"Load Script was called without an URL.\" };\n\t\t}\n\n\t\ttry {\n\t\t\tthis._scope.importScripts( url );\n\t\t} catch ( error ) {\n\t\t\treturn { loaded: false, url, message: error.message };\n\t\t}\n\n\t\treturn { loaded: true, url };\n\t}\n\n\t/**\n\t * Sends the load script result back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tloadScriptDone( id, result ) {\n\t\tif ( ! result.loaded ) {\n\t\t\tthis.send( \"loadScript:failed\", id, result );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.send( \"loadScript:done\", id, result );\n\t}\n\n\t/**\n\t * Sends the analyze result back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tanalyzeDone( id, result ) {\n\t\tif ( result.error ) {\n\t\t\tthis.send( \"analyze:failed\", id, result );\n\t\t\treturn;\n\t\t}\n\t\tthis.send( \"analyze:done\", id, result );\n\t}\n\n\t/**\n\t * Sends the analyze related keywords result back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tanalyzeRelatedKeywordsDone( id, result ) {\n\t\tif ( result.error ) {\n\t\t\tthis.send( \"analyzeRelatedKeywords:failed\", id, result );\n\t\t\treturn;\n\t\t}\n\t\tthis.send( \"analyzeRelatedKeywords:done\", id, result );\n\t}\n\n\t/**\n\t * Handle a custom message using the registered handler.\n\t *\n\t * @param {number} id   The request id.\n\t * @param {string} name The name of the message.\n\t * @param {Object} data The data of the message.\n\t *\n\t * @returns {Object} An object containing either success and data or an error.\n\t */\n\tcustomMessage( id, { name, data } ) {\n\t\ttry {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: this._registeredMessageHandlers[ name ]( data ),\n\t\t\t};\n\t\t} catch ( error ) {\n\t\t\treturn { error };\n\t\t}\n\t}\n\n\t/**\n\t * Send the result of a custom message back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tcustomMessageDone( id, result ) {\n\t\tif ( result.success ) {\n\t\t\tthis.send( \"customMessage:done\", id, result.data );\n\t\t\treturn;\n\t\t}\n\t\tthis.send( \"customMessage:failed\", result.error );\n\t}\n\n\t/**\n\t * Runs the specified research in the worker. Optionally pass a paper.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {string} name   The name of the research to run.\n\t * @param {Paper} [paper] The paper to run the research on if it shouldn't\n\t *                        be run on the latest paper.\n\t *\n\t * @returns {Object} The result of the research.\n\t */\n\trunResearch( id, { name, paper = null } ) {\n\t\t// When a specific paper is passed we create a temporary new researcher.\n\t\tconst researcher = paper === null\n\t\t\t? this._researcher\n\t\t\t: new Researcher( paper );\n\n\t\treturn researcher.getResearch( name );\n\t}\n\n\t/**\n\t * Send the result of a custom message back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\trunResearchDone( id, result ) {\n\t\tif ( result.error ) {\n\t\t\tthis.send( \"runResearch:failed\", id, result );\n\t\t\treturn;\n\t\t}\n\t\tthis.send( \"runResearch:done\", id, result );\n\t}\n}\n"]}