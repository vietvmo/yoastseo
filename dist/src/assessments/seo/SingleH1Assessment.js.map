{"version":3,"sources":["../../../../src/assessments/seo/SingleH1Assessment.js"],"names":["map","merge","isUndefined","Assessment","createAnchorOpeningTag","marker","AssessmentResult","Mark","singleH1Assessment","constructor","config","defaultConfig","scores","textContainsSuperfluousH1","urlTitle","urlCallToAction","identifier","_config","getResult","paper","researcher","i18n","_h1s","getResearch","assessmentResult","calculatedResult","calculateResult","setScore","score","setText","resultText","setHasMarks","firstH1AtBeginning","position","length","sprintf","dgettext","getMarks","h1s","shift","h1","original","content","marked","isApplicable","hasText"],"mappings":"AAAA,SAASA,GAAT,QAAoB,WAApB;AACA,SAASC,KAAT,QAAsB,WAAtB;AACA,SAASC,WAAT,QAA4B,WAA5B;;AAEA,OAAOC,UAAP,MAAuB,qBAAvB;AACA,SAASC,sBAAT,QAAuC,2BAAvC;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,gBAAP,MAA6B,kCAA7B;AACA,OAAOC,IAAP,MAAiB,sBAAjB;;AAEA;;;;AAIA,MAAMC,kBAAN,SAAiCL,UAAjC,CAA4C;AAC3C;;;;;;;AAOAM,aAAaC,SAAS,EAAtB,EAA2B;AAC1B;;AAEA,QAAMC,gBAAgB;AACrBC,WAAQ;AACPC,+BAA2B;AADpB,IADa;AAIrBC,aAAUV,uBAAwB,oBAAxB,CAJW;AAKrBW,oBAAiBX,uBAAwB,oBAAxB;AALI,GAAtB;;AAQA,OAAKY,UAAL,GAAkB,UAAlB;AACA,OAAKC,OAAL,GAAehB,MAAOU,aAAP,EAAsBD,MAAtB,CAAf;AACA;;AAED;;;;;;;;;AASAQ,WAAWC,KAAX,EAAkBC,UAAlB,EAA8BC,IAA9B,EAAqC;AACpC,OAAKC,IAAL,GAAYF,WAAWG,WAAX,CAAwB,KAAxB,CAAZ;;AAEA,QAAMC,mBAAmB,IAAIlB,gBAAJ,EAAzB;;AAEA,QAAMmB,mBAAmB,KAAKC,eAAL,CAAsBL,IAAtB,CAAzB;;AAEA,MAAK,CAAEnB,YAAauB,gBAAb,CAAP,EAAyC;AACxCD,oBAAiBG,QAAjB,CAA2BF,iBAAiBG,KAA5C;AACAJ,oBAAiBK,OAAjB,CAA0BJ,iBAAiBK,UAA3C;AACAN,oBAAiBO,WAAjB,CAA8B,IAA9B;AACA;;AAED,SAAOP,gBAAP;AACA;;AAED;;;;;AAKAQ,sBAAqB;AACpB,SAAS,KAAKV,IAAL,CAAW,CAAX,EAAeW,QAAf,KAA4B,CAArC;AACA;;AAED;;;;;;;AAOAP,iBAAiBL,IAAjB,EAAwB;AACvB;AACA,MAAK,KAAKC,IAAL,CAAUY,MAAV,KAAqB,CAA1B,EAA8B;AAC7B;AACA;;AAED;AACA,MAAK,KAAKZ,IAAL,CAAUY,MAAV,KAAqB,CAArB,IAA0B,KAAKF,kBAAL,EAA/B,EAA2D;AAC1D;AACA;;AAED,SAAO;AACNJ,UAAO,KAAKX,OAAL,CAAaL,MAAb,CAAoBC,yBADrB;AAENiB,eAAYT,KAAKc,OAAL;AACX;AACAd,QAAKe,QAAL,CACC,kBADD,EAEC,iGACA,+EAHD,CAFW,EAOX,KAAKnB,OAAL,CAAaH,QAPF,EAQX,KAAKG,OAAL,CAAaF,eARF,EASX,MATW;AAFN,GAAP;AAcA;;AAED;;;;;;AAMAsB,YAAW;AACV,QAAMC,MAAM,KAAKhB,IAAjB;;AAEA;;;;AAIA,MAAK,KAAKU,kBAAL,EAAL,EAAiC;AAChCM,OAAIC,KAAJ;AACA;;AAED,SAAOvC,IAAKsC,GAAL,EAAU,UAAUE,EAAV,EAAe;AAC/B,UAAO,IAAIjC,IAAJ,CAAU;AAChBkC,cAAU,SAASD,GAAGE,OAAZ,GAAsB,OADhB;AAEhBC,YAAQ,SAAStC,OAAQmC,GAAGE,OAAX,CAAT,GAAgC;AAFxB,IAAV,CAAP;AAIA,GALM,CAAP;AAMA;;AAED;;;;;;;AAOAE,cAAczB,KAAd,EAAsB;AACrB,SAAOA,MAAM0B,OAAN,EAAP;AACA;AA7H0C;;AAgI5C,eAAerC,kBAAf","file":"SingleH1Assessment.js","sourcesContent":["import { map } from \"lodash-es\";\nimport { merge } from \"lodash-es\";\nimport { isUndefined } from \"lodash-es\";\n\nimport Assessment from \"../../assessment.js\";\nimport { createAnchorOpeningTag } from \"../../helpers/shortlinker\";\nimport marker from \"../../markers/addMark.js\";\nimport AssessmentResult from \"../../values/AssessmentResult.js\";\nimport Mark from \"../../values/Mark.js\";\n\n/**\n * Assessment to check whether the body of the text contains H1s in the body (except at the very beginning,\n * where they are acceptable).\n */\nclass singleH1Assessment extends Assessment {\n\t/**\n\t * Sets the identifier and the config.\n\t *\n\t * @param {Object} config The configuration to use.\n\t *\n\t * @returns {void}\n\t */\n\tconstructor( config = {} ) {\n\t\tsuper();\n\n\t\tconst defaultConfig = {\n\t\t\tscores: {\n\t\t\t\ttextContainsSuperfluousH1: 1,\n\t\t\t},\n\t\t\turlTitle: createAnchorOpeningTag( \"https://yoa.st/3a6\" ),\n\t\t\turlCallToAction: createAnchorOpeningTag( \"https://yoa.st/3a7\" ),\n\t\t};\n\n\t\tthis.identifier = \"singleH1\";\n\t\tthis._config = merge( defaultConfig, config );\n\t}\n\n\t/**\n\t * Runs the h1 research and based on this returns an assessment result with a score.\n\t *\n\t * @param {Paper} paper The paper to use for the assessment.\n\t * @param {Researcher} researcher The researcher used for calling the research.\n\t * @param {Jed} i18n The object used for translations\n\t *\n\t * @returns {AssessmentResult} The assessment result.\n\t */\n\tgetResult( paper, researcher, i18n ) {\n\t\tthis._h1s = researcher.getResearch( \"h1s\" );\n\n\t\tconst assessmentResult = new AssessmentResult();\n\n\t\tconst calculatedResult = this.calculateResult( i18n );\n\n\t\tif ( ! isUndefined( calculatedResult ) ) {\n\t\t\tassessmentResult.setScore( calculatedResult.score );\n\t\t\tassessmentResult.setText( calculatedResult.resultText );\n\t\t\tassessmentResult.setHasMarks( true );\n\t\t}\n\n\t\treturn assessmentResult;\n\t}\n\n\t/**\n\t * Checks whether an H1 is in the first position of the body.\n\t *\n\t * @returns {boolean} Returns true if there is an H1 in the first position of the body.\n\t */\n\tfirstH1AtBeginning() {\n\t\treturn ( this._h1s[ 0 ].position === 0 );\n\t}\n\n\t/**\n\t * Returns the score and the feedback string for the single H1 assessment.\n\t *\n\t * @param {Jed} i18n The object used for translations.\n\t *\n\t * @returns {Object|null} The calculated score and the feedback string.\n\t */\n\tcalculateResult( i18n ) {\n\t\t// Returns the default assessment result if there are no H1s in the body.\n\t\tif ( this._h1s.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Returns the default assessment result if there is one H1 and it's at the beginning of the body.\n\t\tif ( this._h1s.length === 1 && this.firstH1AtBeginning() ) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tscore: this._config.scores.textContainsSuperfluousH1,\n\t\t\tresultText: i18n.sprintf(\n\t\t\t\t/* Translators: %1$s and %2$s expand to links on yoast.com, %3$s expands to the anchor end tag */\n\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\"%1$sSingle title%3$s: H1s should only be used as your main title. Find all H1s in your text \" +\n\t\t\t\t\t\"that aren't your main title and %2$schange them to a lower heading level%3$s!\"\n\t\t\t\t),\n\t\t\t\tthis._config.urlTitle,\n\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\"</a>\"\n\t\t\t),\n\t\t};\n\t}\n\n\t/**\n\t * Marks all H1s in the body of the text (except at the very beginning,\n\t * where they are acceptable and don't need to be changed).\n\t *\n\t * @returns {Array} Array with all the marked H1s.\n\t */\n\tgetMarks() {\n\t\tconst h1s = this._h1s;\n\n\t\t/*\n\t\t * Removes the first H1 from the array if that H1 is in the first position of the body.\n\t\t * The very beginning of the body is the only position where an H1 is deemed acceptable.\n\t\t */\n\t\tif ( this.firstH1AtBeginning() ) {\n\t\t\th1s.shift();\n\t\t}\n\n\t\treturn map( h1s, function( h1 ) {\n\t\t\treturn new Mark( {\n\t\t\t\toriginal: \"<h1>\" + h1.content + \"</h1>\",\n\t\t\t\tmarked: \"<h1>\" + marker( h1.content ) + \"</h1>\",\n\t\t\t} );\n\t\t} );\n\t}\n\n\t/**\n\t * Checks whether the paper has a text.\n\t *\n\t * @param {Paper} paper The paper to use for the assessment.\n\t *\n\t * @returns {boolean} True when there is text.\n\t */\n\tisApplicable( paper ) {\n\t\treturn paper.hasText();\n\t}\n}\n\nexport default singleH1Assessment;\n"]}