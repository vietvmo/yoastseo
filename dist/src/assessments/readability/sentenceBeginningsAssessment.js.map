{"version":3,"sources":["../../../../src/assessments/readability/sentenceBeginningsAssessment.js"],"names":["filter","flatten","map","partition","sortBy","marker","createAnchorOpeningTag","stripIncompleteTags","stripTags","AssessmentResult","Mark","maximumConsecutiveDuplicates","getLanguageAvailability","availableLanguages","groupSentenceBeginnings","sentenceBeginnings","tooOften","word","count","length","total","sortedCounts","lowestCount","calculateSentenceBeginningsResult","groupedSentenceBeginnings","i18n","urlTitle","urlCallToAction","score","hasMarks","text","sprintf","dngettext","dgettext","sentenceBeginningMarker","paper","researcher","getResearch","sentenceBeginning","sentences","begin","sentence","marked","original","sentenceBeginningsAssessment","sentenceBeginningsResult","assessmentResult","setScore","setText","setHasMarks","isApplicable","isLanguageAvailable","getLocale","hasText","identifier","getResult","getMarks"],"mappings":"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","file":"sentenceBeginningsAssessment.js","sourcesContent":["import { filter, flatten, map, partition, sortBy } from \"lodash-es\";\n\nimport marker from \"../../markers/addMark\";\nimport { createAnchorOpeningTag } from \"../../helpers/shortlinker\";\nimport { stripIncompleteTags as stripTags } from \"../../stringProcessing/stripHTMLTags\";\nimport AssessmentResult from \"../../values/AssessmentResult\";\nimport Mark from \"../../values/Mark\";\n\nconst maximumConsecutiveDuplicates = 2;\n\nimport getLanguageAvailability from \"../../helpers/getLanguageAvailability.js\";\nconst availableLanguages = [ \"en\", \"de\", \"es\", \"fr\", \"nl\", \"it\", \"ru\", \"pl\", \"sv\" ];\n\n/**\n * Counts and groups the number too often used sentence beginnings and determines the lowest count within that group.\n * @param {array} sentenceBeginnings The array containing the objects containing the beginning words and counts.\n * @returns {object} The object containing the total number of too often used beginnings and the lowest count within those.\n */\nconst groupSentenceBeginnings = function( sentenceBeginnings ) {\n\tconst tooOften = partition( sentenceBeginnings, function( word ) {\n\t\treturn word.count > maximumConsecutiveDuplicates;\n\t} );\n\n\tif ( tooOften[ 0 ].length === 0 ) {\n\t\treturn { total: 0 };\n\t}\n\n\tconst sortedCounts = sortBy( tooOften[ 0 ], function( word ) {\n\t\treturn word.count;\n\t} );\n\n\treturn { total: tooOften[ 0 ].length, lowestCount: sortedCounts[ 0 ].count };\n};\n\n/**\n * Calculates the score based on sentence beginnings.\n * @param {object} groupedSentenceBeginnings The object with grouped sentence beginnings.\n * @param {object} i18n The object used for translations.\n * @returns {{score: number, text: string, hasMarks: boolean}} result object with score and text.\n */\nconst calculateSentenceBeginningsResult = function( groupedSentenceBeginnings, i18n ) {\n\tconst urlTitle = createAnchorOpeningTag( \"https://yoa.st/35f\" );\n\tconst urlCallToAction = createAnchorOpeningTag( \"https://yoa.st/35g\" );\n\n\tif ( groupedSentenceBeginnings.total > 0 ) {\n\t\treturn {\n\t\t\tscore: 3,\n\t\t\thasMarks: true,\n\t\t\ttext: i18n.sprintf(\n\t\t\t\t/* Translators: %1$s and %5$s expand to a link on yoast.com, %2$s expands to the anchor end tag,\n\t\t\t\t%3$d expands to the number of consecutive sentences starting with the same word,\n\t\t\t\t%4$d expands to the number of instances where 3 or more consecutive sentences start with the same word. */\n\t\t\t\ti18n.dngettext(\n\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\"%1$sConsecutive sentences%2$s: The text contains %3$d consecutive sentences starting with the same word.\" +\n\t\t\t\t\t\" %5$sTry to mix things up%2$s!\", \"%1$sConsecutive sentences%2$s: The text contains %4$d instances where\" +\n\t\t\t\t\t\" %3$d or more consecutive sentences start with the same word. %5$sTry to mix things up%2$s!\",\n\t\t\t\t\tgroupedSentenceBeginnings.total\n\t\t\t\t),\n\t\t\t\turlTitle,\n\t\t\t\t\"</a>\",\n\t\t\t\tgroupedSentenceBeginnings.lowestCount,\n\t\t\t\tgroupedSentenceBeginnings.total,\n\t\t\t\turlCallToAction\n\t\t\t),\n\t\t};\n\t}\n\treturn {\n\t\tscore: 9,\n\t\thasMarks: false,\n\t\ttext: i18n.sprintf(\n\t\t\t/* Translators:  %1$s expands to a link on yoast.com, %2$s expands to the anchor end tag */\n\t\t\ti18n.dgettext( \"js-text-analysis\",\n\t\t\t\t\"%1$sConsecutive sentences%2$s: There is enough variety in your sentences. That's great!\" ),\n\t\t\turlTitle,\n\t\t\t\"</a>\"\n\t\t),\n\t};\n};\n\n/**\n * Marks all consecutive sentences with the same beginnings.\n * @param {object} paper The paper to use for the assessment.\n * @param {object} researcher The researcher used for calling research.\n * @returns {object} All marked sentences.\n */\nconst sentenceBeginningMarker = function( paper, researcher ) {\n\tlet sentenceBeginnings = researcher.getResearch( \"getSentenceBeginnings\" );\n\tsentenceBeginnings = filter( sentenceBeginnings, function( sentenceBeginning ) {\n\t\treturn sentenceBeginning.count > maximumConsecutiveDuplicates;\n\t} );\n\n\tconst sentences = map( sentenceBeginnings, function( begin ) {\n\t\treturn begin.sentences;\n\t} );\n\n\treturn map( flatten( sentences ), function( sentence ) {\n\t\tsentence = stripTags( sentence );\n\t\tconst marked = marker( sentence );\n\t\treturn new Mark( {\n\t\t\toriginal: sentence,\n\t\t\tmarked: marked,\n\t\t} );\n\t} );\n};\n\n/**\n * Scores the repetition of sentence beginnings in consecutive sentences.\n * @param {object} paper The paper to use for the assessment.\n * @param {object} researcher The researcher used for calling research.\n * @param {object} i18n The object used for translations.\n * @returns {object} The Assessment result\n */\nconst sentenceBeginningsAssessment = function( paper, researcher, i18n ) {\n\tconst sentenceBeginnings = researcher.getResearch( \"getSentenceBeginnings\" );\n\tconst groupedSentenceBeginnings = groupSentenceBeginnings( sentenceBeginnings );\n\tconst sentenceBeginningsResult = calculateSentenceBeginningsResult( groupedSentenceBeginnings, i18n );\n\tconst assessmentResult = new AssessmentResult();\n\n\tassessmentResult.setScore( sentenceBeginningsResult.score );\n\tassessmentResult.setText( sentenceBeginningsResult.text );\n\tassessmentResult.setHasMarks( sentenceBeginningsResult.hasMarks );\n\treturn assessmentResult;\n};\n\n/**\n * Checks if the sentence beginnings assessment is applicable to the paper.\n *\n * @param {Object} paper The paper to check.\n *\n * @returns {boolean} Returns true if the language is available and the paper is not empty.\n */\nconst isApplicable = function( paper ) {\n\tconst isLanguageAvailable = getLanguageAvailability( paper.getLocale(), availableLanguages );\n\treturn ( isLanguageAvailable && paper.hasText() );\n};\n\nexport default {\n\tidentifier: \"sentenceBeginnings\",\n\tgetResult: sentenceBeginningsAssessment,\n\tisApplicable: isApplicable,\n\tgetMarks: sentenceBeginningMarker,\n};\n\n"]}