{"version":3,"sources":["../../../../src/assessments/readability/transitionWordsAssessment.js"],"names":["map","formatNumber","inRangeStartInclusive","inRange","createAnchorOpeningTag","stripIncompleteTags","stripTags","AssessmentResult","Mark","marker","getLanguageAvailability","availableLanguages","calculateTransitionWordPercentage","sentences","transitionWordSentences","totalSentences","calculateScoreFromPercentage","percentage","calculateTransitionWordResult","i18n","score","hasMarks","urlTitle","urlCallToAction","text","sprintf","dgettext","transitionWordsAssessment","paper","researcher","getResearch","transitionWordResult","assessmentResult","setScore","setText","setHasMarks","transitionWordsMarker","sentenceResults","sentenceResult","sentence","original","marked","isApplicable","isLanguageAvailable","getLocale","hasText","identifier","getResult","getMarks"],"mappings":"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","file":"transitionWordsAssessment.js","sourcesContent":["import { map } from \"lodash-es\";\n\nimport formatNumber from \"../../helpers/formatNumber\";\nimport { inRangeStartInclusive as inRange } from \"../../helpers/inRange\";\nimport { createAnchorOpeningTag } from \"../../helpers/shortlinker\";\nimport { stripIncompleteTags as stripTags } from \"../../stringProcessing/stripHTMLTags\";\nimport AssessmentResult from \"../../values/AssessmentResult\";\nimport Mark from \"../../values/Mark.js\";\nimport marker from \"../../markers/addMark.js\";\nimport getLanguageAvailability from \"../../helpers/getLanguageAvailability.js\";\nconst availableLanguages = [ \"en\", \"de\", \"es\", \"fr\", \"nl\", \"it\", \"pt\", \"ru\", \"ca\", \"pl\", \"sv\" ];\n\n/**\n * Calculates the actual percentage of transition words in the sentences.\n *\n * @param {object} sentences The object containing the total number of sentences and the number of sentences containing\n * a transition word.\n * @returns {number} The percentage of sentences containing a transition word.\n */\nconst calculateTransitionWordPercentage = function( sentences ) {\n\tif ( sentences.transitionWordSentences === 0 || sentences.totalSentences === 0 ) {\n\t\treturn 0;\n\t}\n\n\treturn formatNumber( ( sentences.transitionWordSentences / sentences.totalSentences ) * 100 );\n};\n\n/**\n * Calculates the score for the assessment based on the percentage of sentences containing transition words.\n *\n * @param {number} percentage The percentage of sentences containing transition words.\n * @returns {number} The score.\n */\nconst calculateScoreFromPercentage = function( percentage ) {\n\tif ( percentage < 20 ) {\n\t\t// Red indicator.\n\t\treturn 3;\n\t}\n\n\tif ( inRange( percentage, 20, 30 ) ) {\n\t\t// Orange indicator.\n\t\treturn 6;\n\t}\n\n\tif ( percentage >= 30 ) {\n\t\t// Green indicator.\n\t\treturn 9;\n\t}\n};\n\n/**\n * Calculates transition word result\n * @param {object} transitionWordSentences The object containing the total number of sentences and the number of sentences containing\n * a transition word.\n * @param {object} i18n The object used for translations.\n * @returns {object} Object containing score and text.\n */\nconst calculateTransitionWordResult = function( transitionWordSentences, i18n ) {\n\tconst percentage = calculateTransitionWordPercentage( transitionWordSentences );\n\tconst score = calculateScoreFromPercentage( percentage );\n\tconst hasMarks   = ( percentage > 0 );\n\tconst urlTitle = createAnchorOpeningTag( \"https://yoa.st/34z\" );\n\tconst urlCallToAction = createAnchorOpeningTag( \"https://yoa.st/35a\" );\n\n\tif ( score < 7 && percentage === 0 ) {\n\t\treturn {\n\t\t\tscore: formatNumber( score ),\n\t\t\thasMarks: hasMarks,\n\t\t\ttext: i18n.sprintf(\n\t\t\t\t/* Translators: %1$s and %3$s expand to a link to yoast.com, %2$s expands to the anchor end tag */\n\t\t\t\ti18n.dgettext( \"js-text-analysis\",\n\t\t\t\t\t\"%1$sTransition words%2$s: None of the sentences contain transition words. %3$sUse some%2$s.\"\n\t\t\t\t),\n\t\t\t\turlTitle,\n\t\t\t\t\"</a>\",\n\t\t\t\turlCallToAction ),\n\t\t};\n\t}\n\n\tif ( score < 7 ) {\n\t\treturn {\n\t\t\tscore: formatNumber( score ),\n\t\t\thasMarks: hasMarks,\n\t\t\ttext: i18n.sprintf(\n\t\t\t\t/* Translators: %1$s and %4$s expand to a link to yoast.com, %2$s expands to the anchor end tag,\n\t\t\t\t%3$s expands to the percentage of sentences containing transition words */\n\t\t\t\ti18n.dgettext( \"js-text-analysis\",\n\t\t\t\t\t\"%1$sTransition words%2$s: Only %3$s of the sentences contain transition words, which is not enough. %4$sUse more of them%2$s.\"\n\t\t\t\t),\n\t\t\t\turlTitle,\n\t\t\t\t\"</a>\",\n\t\t\t\tpercentage + \"%\",\n\t\t\t\turlCallToAction ),\n\t\t};\n\t}\n\n\treturn {\n\t\tscore: formatNumber( score ),\n\t\thasMarks: hasMarks,\n\t\ttext: i18n.sprintf(\n\t\t\t/* Translators: %1$s expands to a link on yoast.com, %3$s expands to the anchor end tag. */\n\t\t\ti18n.dgettext( \"js-text-analysis\",\n\t\t\t\t\"%1$sTransition words%2$s: Well done!\"\n\t\t\t),\n\t\t\turlTitle,\n\t\t\t\"</a>\" ),\n\t};\n};\n\n/**\n * Scores the percentage of sentences including one or more transition words.\n * @param {object} paper The paper to use for the assessment.\n * @param {object} researcher The researcher used for calling research.\n * @param {object} i18n The object used for translations.\n * @returns {object} The Assessment result.\n */\nconst transitionWordsAssessment = function( paper, researcher, i18n ) {\n\tconst transitionWordSentences = researcher.getResearch( \"findTransitionWords\" );\n\tconst transitionWordResult = calculateTransitionWordResult( transitionWordSentences, i18n );\n\tconst assessmentResult = new AssessmentResult();\n\n\tassessmentResult.setScore( transitionWordResult.score );\n\tassessmentResult.setText( transitionWordResult.text );\n\tassessmentResult.setHasMarks( transitionWordResult.hasMarks );\n\n\treturn assessmentResult;\n};\n\n/**\n * Marks text for the transition words assessment.\n * @param {Paper} paper The paper to use for the marking.\n * @param {Researcher} researcher The researcher containing the necessary research.\n * @returns {Array<Mark>} A list of marks that should be applied.\n */\nconst transitionWordsMarker = function( paper, researcher ) {\n\tconst transitionWordSentences = researcher.getResearch( \"findTransitionWords\" );\n\n\treturn map( transitionWordSentences.sentenceResults, function( sentenceResult ) {\n\t\tlet sentence = sentenceResult.sentence;\n\t\tsentence = stripTags( sentence );\n\t\treturn new Mark( {\n\t\t\toriginal: sentence,\n\t\t\tmarked: marker( sentence ),\n\t\t} );\n\t} );\n};\n\n/**\n * Checks if the transition words assessment is applicable to the paper.\n *\n * @param {Object} paper The paper to check.\n *\n * @returns {boolean} Returns true if the language is available and the paper is not empty.\n */\nconst isApplicable = function( paper ) {\n\tconst isLanguageAvailable = getLanguageAvailability( paper.getLocale(), availableLanguages );\n\treturn ( isLanguageAvailable && paper.hasText() );\n};\n\nexport default {\n\tidentifier: \"textTransitionWords\",\n\tgetResult: transitionWordsAssessment,\n\tisApplicable: isApplicable,\n\tgetMarks: transitionWordsMarker,\n};\n"]}